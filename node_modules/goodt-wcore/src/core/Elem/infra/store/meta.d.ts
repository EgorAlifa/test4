import { ElemDescriptorVarAliasesMap, IElemInstance } from '@goodt-wcore/elem';
import { IPanelInstance } from '@goodt-wcore/panel';

export const StoreOperation: {
    ALL: ['listen', 'trigger'];
    READ: ['listen'];
    WRITE: ['trigger'];
} = undefined;

export type StoreOperationType = (typeof StoreOperation)[keyof typeof StoreOperation];

interface IElemStoreMetaApi {
    vars: {
        use(varAliases: ElemDescriptorVarAliasesMap): IElemStoreMetaApi['vars'];
        read: string[];
        write: string[];
        readMap: Record<string, any>;
        writeMap: Record<string, any>;
    };
}

interface IPanelStoreMetaApi extends IElemStoreMetaApi {
    setVar({
        varAlias,
        storeVar = varAlias,
        operation = StoreOperation.ALL
    }: {
        varAlias: string;
        storeVar?: string;
        operation?: StoreOperationType;
    });

    deleteVar({
        varAlias,
        operation = StoreOperation.ALL
    }: {
        varAlias: string;
        storeVar?: string;
        operation?: StoreOperationType;
    });
}

/**
 *
 * @param vm
 */
export function createElemStoreMeta(vm: IElemInstance): IElemStoreMetaApi;

/**
 *
 * @param vm
 */
export function createPanelStoreMeta(vm: IPanelInstance): IPanelStoreMetaApi;

/**
 * @type {{ $storeMeta: ReturnType<typeof $storeMeta> }}
 */
export type PanelStoreMetaInject = {
    $storeMeta: IPanelStoreMetaApi;
};

export type ElemStoreMetaInject = {
    $storeMeta: IElemStoreMetaApi;
};
