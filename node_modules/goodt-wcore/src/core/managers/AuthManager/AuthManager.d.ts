/**
 * @typedef {object} AdapterInfo
 * @property {string} name      name
 * @property {Record<string, any>} config default config
 */
import Adapter from '@goodt-common/auth/adapters/Adapter';

export type AuthManagerAuthErrorHandler = (error: Error) => void;

export type AuthManagerLoginHandler = () => Promise<any>;

export type AuthManagerLogoutHandler = () => Promise<any>;

export default class AuthManager {
    /**
     * @return {AuthManager}
     */
    static instance: AuthManager;

    static create(): AuthManager;

    /**
     * Constructor
     *
     * @param {symbol} enforcer  singleton enforcer
     */
    constructor(enforcer: symbol);

    /**
     * @property {Adapter}
     */
    private _adapter: any;

    /**
     * Initializes manager with the specified adapter
     *
     * @param {string} adapterName  adapter name
     * @param {Record<string, any>} config       adapter config
     * @return {Promise}
     */
    init(adapterName: string, config?: Record<string, any>): Promise<any>;

    setAdapters(adapters: Record<string, Adapter>) {
        this._adapters = adapters;
    }

    /**
     * Destroys adapter
     */
    destroy(): Promise<any>;

    /**
     * Invokes login handlers
     */
    login(): Promise;

    /**
     * Invokes login handlers
     */
    logout(): Promise;

    /**
     * Invokes auth error handlers
     * @param {Error} [error]
     */
    authError(error?: Error): void;

    /**
     * Adds a new auth error observer
     */
    onAuthError(handler: AuthManagerAuthErrorHandler): Function;

    /**
     * Adds a new login observer
     */
    onLogin(handler: AuthManagerLoginHandler): Function;

    /**
     * Adds a new login observer
     */
    onLogout(handler: AuthManagerLogoutHandler): Function;

    /**
     * Current used adapter
     *
     * @return {Adapter} adapter
     */
    readonly adapter: any;

    /**
     * Available adapters list
     *
     * @return {object.<string, Adapter>}
     */
    readonly adaptersList: Record<string, Adapter>;

    /**
     * Available adapters info
     *
     * @return {AdapterInfo[]}
     */
    readonly adaptersInfo: AdapterInfo[];

    /**
     * @private
     * @param {string} adapterName
     * @param {Record<string, any>} config
     * @return
     */
    private _createAdapter;
}
export type AdapterInfo = {
    /**
     * name
     */
    name: string;
    /**
     * default config
     */
    config: Record<string, any>;
};
