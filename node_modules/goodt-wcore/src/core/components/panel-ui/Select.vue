<template>
    <div>
        <control-layout v-bind="{ prop, colSize }">
            <template #label="{ getLabel }">
                <!--
                @slot label slot
                -->
                <slot v-bind="{ getLabel }" />
            </template>
            <template #hint="{ getHint }">
                <!--
                @slot hint slot
                -->
                <slot name="hint" v-bind="{ getHint }" />
            </template>
            <template #control>
                <ui-select
                    class="w-12-12"
                    :class="controlCl"
                    type="text"
                    size="small"
                    v-bind="selectAttrs"
                    v-on="listeners">
                    <template #label="binds">
                        <slot name="select:label" v-bind="binds"></slot>
                    </template>
                    <template #option-label="binds">
                        <slot name="select:option-label" v-bind="binds"></slot>
                    </template>
                </ui-select>
            </template>
        </control-layout>
    </div>
</template>
<script>
import { Select as UiSelect } from 'goodteditor-ui';
import { ControlMixin } from './utils';

/**
 * For more <b>props</b> @see https://goodt-ui.netlify.app/#!/Select
 */
export default {
    components: { UiSelect },
    mixins: [ControlMixin],
    props: {
        /** @model */
        value: {
            type: [Number, String, Array, Object, Boolean],
            default: null
        },
        /**
         * Options Array[Object] ~ [ { value:'', label: '' } ]
         */
        options: {
            type: Array,
            default() {
                return [];
            }
        },
        /**
         * Allow multiple selection
         */
        multiple: {
            type: Boolean,
            default: false
        }
    },
    computed: {
        selectAttrs() {
            const { options, multiple, ...rest } = this.attrs;
            // prettier-ignore
            const normalizedOptions = this.options.map((option) =>
                option === Object(option) && Array.isArray(option) === false // is object
                    ? option
                    : { label: String(option ?? ''), value: option }
            );

            return {
                ...rest,
                options: normalizedOptions,
                multiple: this.multiple
            };
        }
    }
};
</script>
