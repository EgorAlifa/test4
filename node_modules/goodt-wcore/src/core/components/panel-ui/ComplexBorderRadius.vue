<template>
    <div class="row">
        <div class="col" :class="colSizeCl">
            <ui-container>
                <div class="row row-hgap-l1 flex-nowrap">
                    <div class="col col-auto">
                        <button
                            class="btn btn-icon"
                            :class="toggleButtonClass"
                            :title="toggleButtonLabel"
                            @click="toggle">
                            <span class="icon">
                                <i class="mdi mdi-18px mdi-border-radius"></i>
                            </span>
                        </button>
                    </div>
                    <div class="col">
                        <ui-container v-if="isShownAll">
                            <div class="row row-hgap-l1 row-vgap-4">
                                <div class="col col-6-12 col-vbot">
                                    <ui-input-units v-model="model.topLeft" v-bind="binds">
                                        <span class="icon color-primary rotate-icon-270">
                                            <i class="mdi mdi-18px mdi-rounded-corner"></i>
                                        </span>
                                        <span>Скругление</span>
                                    </ui-input-units>
                                </div>
                                <div class="col col-6-12 col-vbot">
                                    <ui-input-units v-model="model.topRight" v-bind="binds">
                                        <span class="icon color-primary">
                                            <i class="mdi mdi-18px mdi-rounded-corner"></i>
                                        </span>
                                        <span>Скругление</span>
                                    </ui-input-units>
                                </div>
                                <div class="col col-6-12 col-vbot">
                                    <ui-input-units v-model="model.bottomLeft" v-bind="binds">
                                        <span class="icon color-primary rotate-icon-180">
                                            <i class="mdi mdi-18px mdi-rounded-corner"></i>
                                        </span>
                                        <span>Скругление</span>
                                    </ui-input-units>
                                </div>
                                <div class="col col-6-12 col-vbot">
                                    <ui-input-units v-model="model.bottomRight" v-bind="binds">
                                        <div class="icon color-primary rotate-icon-90">
                                            <i class="mdi mdi-18px mdi-rounded-corner"></i>
                                        </div>
                                        <span>Скругление</span>
                                    </ui-input-units>
                                </div>
                            </div>
                        </ui-container>
                        <ui-input-units v-else :value="model.topLeft" v-bind="binds" @change="updateAll">
                            Скругление
                        </ui-input-units>
                    </div>
                </div>
            </ui-container>
        </div>
    </div>
</template>

<style lang="pcss" scoped>
.rotate-icon-90 {
    transform: rotate(90deg);
}
.rotate-icon-180 {
    transform: rotate(180deg);
}
.rotate-icon-270 {
    transform: rotate(270deg);
}
</style>

<script>
import { ControlMixin, createBorderRadius, ObjectControlMixin } from './utils';
import UiInputUnits from './InputUnits.vue';
import UiContainer from './Container.vue';

export default {
    components: { UiInputUnits, UiContainer },
    mixins: [ControlMixin, ObjectControlMixin],
    props: {
        /**
         * Options Array[String]
         */
        units: {
            type: Array,
            default: () => []
        }
    },
    data: () => ({
        isShownAll: false
    }),
    computed: {
        binds() {
            const { units } = this;
            return {
                units
            };
        },
        toggleButtonClass() {
            const { isShownAll } = this;
            return {
                'btn-primary': isShownAll,
                'btn-ghost': !isShownAll
            };
        },
        toggleButtonLabel() {
            const { isShownAll } = this;
            return isShownAll ? 'Индивидуально' : 'Все углы';
        },
        colSizeCl() {
            return `col-${this.colSize}`;
        },
    },
    created() {
        this.isShownAll = Object.values(createBorderRadius(this.valueResolved)).some(
            (val, i, values) => i !== 0 && values[i - 1] !== val
        );
    },
    methods: {
        /**
         * @public
         */
        createSettings(settings = createBorderRadius()) {
            return createBorderRadius(settings);
        },
        updateAll(value) {
            const { model } = this;
            this.model = Object.fromEntries(Object.keys(model).map((key) => [key, value]));
        },
        toggle() {
            this.isShownAll = !this.isShownAll;
        }
    }
};
</script>
