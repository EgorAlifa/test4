<template>
    <component :is="Tag" class="btn" :class="cssClass" v-bind="attrs" @click="onClick">
        <slot name="icon">
            <ui-icon :class="{ 'w-auto': hasContent }" :name="icon" v-if="icon"></ui-icon>
        </slot>
        <!--
        @slot Label slot
		@binding {object} icon icon of the menu item
		@binding {string} text text of the menu item
        @example Button label
        -->
        <slot></slot>
        <div v-if="hasBadge" class="btn__badge">
            <!--
            @slot badge slot
            -->
            <slot name="badge"></slot>
        </div>
    </component>
</template>
<script>
import UiIcon from './Icon.vue';

const Type = {
    PRIMARY: { name: 'primary', class: ['btn-primary'] },
    OUTLINE: { name: 'outline', class: ['btn-primary', 'btn-outline'] },
    ERROR: { name: 'error', class: ['btn-primary', 'btn-error'] },
    SUCCESS: { name: 'success', class: ['btn-primary', 'btn-success'] },
    SECONDARY: { name: 'secondary', class: ['btn-secondary'] },
    GHOST: { name: 'ghost', class: ['btn-ghost', 'color-grey'] },
    GHOST_ALT: { name: 'ghost-alt', class: ['btn-ghost', 'color-primary'] }
};

const Size = {
    NORMAL: { name: 'normal', class: [] },
    SMALL: { name: 'small', class: ['btn-small'] },
    XSMALL: { name: 'xsmall', class: ['btn-xsmall'] },
    LARGE: { name: 'large', class: ['btn-large'] },
};

const IconPosition = {
    LEFT: { name: 'left', class: [] },
    RIGHT: { name: 'right', class: ['with-icon-right'] }
};

export default {
    components: { UiIcon },
    inheritAttrs: false,
    props: {
        /**
         * @default primary
         * @values primary,outline,error,success,secondary,ghost,ghost-alt
         */
        type: {
            type: String,
            default: Type.PRIMARY.name,
            validator: (val) =>
                Object.values(Type)
                    .map(({ name }) => name)
                    .includes(val)
        },
        /**
         * @default normal
         * @values normal,small,xsmall
         */
        size: {
            type: String,
            default: Size.NORMAL.name,
            validator: (val) =>
                Object.values(Size)
                    .map(({ name }) => name)
                    .includes(val)
        },
        /**
         * @example account
         */
        icon: {
            type: String,
            default: ''
        },
        /**
         * @default left
         * @values left,right
         */
        iconPosition: {
            type: String,
            default: IconPosition.LEFT.name,
            validator: (val) =>
                Object.values(IconPosition)
                    .map(({ name }) => name)
                    .includes(val)
        },
        loading: {
            type: Boolean,
            default: false
        },
        disabled: {
            type: Boolean,
            default: false
        },
        /**
         * @default submit
         * @values submit,button,reset
         * @deprecated need to replace this with 'submit:boolean' (default:false)
         */
        htmlType: {
            type: String,
            default: ''
        },
        /**
         * @example google.com
         */
        href: {
            type: String,
            default: ''
        }
    },
    computed: {
        Tag() {
            return this.href === '' ? 'button' : 'a';
        },
        hasContent() {
            return this.$slots.default != null;
        },
        hasBadge() {
            return this.$scopedSlots.badge?.() != null;
        },
        cssClass() {
            const { type, size, iconPosition, disabled, loading, $slots } = this;
            const typeDef = Object.values(Type).find(({ name }) => name === type);
            const sizeDef = Object.values(Size).find(({ name }) => name === size);
            const iconPosDef = Object.values(IconPosition).find(({ name }) => name === iconPosition);
            const classes = [...typeDef.class, ...sizeDef.class, ...iconPosDef.class];
            if ($slots.default == null) {
                classes.push('btn-icon');
            }
            if (disabled) {
                classes.push('disabled');
            }
            if (loading) {
                classes.push('btn-loading disabled');
            }
            return classes;
        },
        attrs() {
            const { disabled, ...attrs } = this.$attrs;
            const { htmlType: type, href } = this;
            return {
                ...attrs,
                disabled: this.disabled,
                ...(type !== '' && href === '' && { type }),
                ...(href !== '' && { href })
            };
        }
    },
    methods: {
        focus() {
            this.$el.focus();
        },
        onClick(e) {
            this.$emit('click', e);
        }
    }
};
</script>
<style scoped>
@b btn {
    position: relative;
    display: inline-flex;
    flex-direction: row;
    align-items: center;
    gap: 0.25rem;

    &.with-icon-right {
        flex-direction: row-reverse;
    }
    @e badge {
        position: absolute;
        top: 0;
        right: 0;
        font-size: 0.6rem;
    }
    &.btn-xsmall {
        --size: calc(var(--unit) * 3);
        min-height: var(--size);
        &.btn-icon {
            width: var(--size);
            height: var(--size);
        }
    }
}
</style>
