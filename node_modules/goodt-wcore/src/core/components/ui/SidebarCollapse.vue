<template>
    <div class="ui-sidebar-collapse">
        <div
            class="ui-sidebar-collapse__header pad-l1"
            :class="{
                'is-open': isOpened,
                shadow: shadow,
                'is-disabled': disabled,
                'has-icon': icon,
                'cursor-pointer': hasContent
            }"
            @click="toggleOpen">
            <ui-icon :name="icon" v-if="icon"></ui-icon>
            <div class="text-truncate">
                <!--
                @slot header slot
                @example Header text
                -->
                <slot name="header"></slot>
            </div>
            <ui-group gap="small">
                <!--
                @slot tools slot
                -->
                <slot name="tools"></slot>
                <ui-preloader v-if="loading"></ui-preloader>
                <ui-icon v-else-if="hasContent" :name="isOpened ? 'chevron-down' : 'chevron-right'"></ui-icon>
            </ui-group>
        </div>
        <!--
        @slot content slot
        @example Lorem ipsum sit dolor
        -->
        <div class="ui-sidebar-collapse__content" v-if="isOpened">
            <div class="pad-l1 w-100 text-center" v-if="loading">
                <ui-preloader></ui-preloader>
            </div>
            <slot v-else></slot>
        </div>
    </div>
</template>
<script>
import UiIcon from './Icon.vue';
import UiPreloader from './Preloader.vue';
import UiGroup from './layout/Group.vue';

export default {
    components: { UiIcon, UiPreloader, UiGroup },
    props: {
        /**
         * @vsync
         */
        open: {
            type: Boolean,
            default: false
        },
        disabled: {
            type: Boolean,
            default: false
        },
        /**
         * @example account
         */
        icon: {
            type: String,
            default: ''
        },
        loading: {
            type: Boolean,
            default: false
        },
        shadow: {
            type: Boolean,
            default: true
        }
    },
    data: () => ({ isOpen: false }),
    computed: {
        hasContent() {
            return this.$slots.default != null;
        },
        isOpened() {
            return this.isOpen && this.disabled === false;
        }
    },
    watch: {
        open: {
            handler(isOpen) {
                this.isOpen = isOpen;
            },
            immediate: true
        }
    },
    methods: {
        toggleOpen() {
            if (!this.hasContent) {
                return;
            }
            this.isOpen = !this.isOpen;

            /**
             * @property {boolean} isOpen   open state
             */
            this.$emit('change', this.isOpen);
            /**
             * @property {boolean} isOpen   open state
             */
            this.$emit('update:open', this.isOpen);
        }
    }
};
</script>
<style scoped>
.ui-sidebar-collapse {
    border-bottom: 1px solid var(--color-border);

    &__header {
        position: sticky;
        z-index: 1;
        top: 0;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 0.25rem;
        align-items: center;
        color: var(--color-grey-dark);
        background: var(--color-white);
        user-select: none;

        &:hover,
        &.is-open {
            color: var(--color-primary-hover);
        }

        &.is-open {
            border-bottom: 1px solid var(--color-border);
        }

        &.is-disabled {
            color: var(--color-muted);
            pointer-events: none;
        }

        &.has-icon {
            grid-template-columns: auto 1fr auto;
        }
    }

    &__content {
        position: relative;
        z-index: 0;
    }
}
</style>
