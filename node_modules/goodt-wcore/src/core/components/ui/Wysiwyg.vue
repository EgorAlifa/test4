<template>
    <ui-wysiwyg-editor
        v-bind="{ value, tools, bubbleMenu, focusVisible, autofocus, getImageUrl, editorContent }"
        @input="onInput"
        @change="onChange">
        <!--
        @slot toolbar slot
        @binding {Array[]} toolGroups               array of using tools
        @binding {Function} buildToolBinds          build tool binds function(tool:Record<string,any>)
        -->
        <template #toolbar="{ toolGroups, resolveGroupTitle, buildToolBinds }">
            <slot name="toolbar" v-bind="{ toolGroups, resolveGroupTitle, buildToolBinds }" />
        </template>
        <!--
        @slot group header slot
        @binding {number} groupIndex                index of the tools group
        @binding {string} title                     tools group title
        -->
        <template #group-header="{ groupIndex, title }">
            <slot name="group-header" v-bind="{ groupIndex, title }" />
        </template>
        <!--
        @slot tool slot
        @binding {Record<string, any>} tool         tool already bound to editor context
        -->
        <template #tool="tool">
            <slot name="tool" v-bind="tool" />
        </template>
    </ui-wysiwyg-editor>
</template>

<script>
import { WysiwygEditor as UiWysiwygEditor } from 'goodteditor-ui';

export default {
    components: {
        UiWysiwygEditor
    },
    props: {
        value: {
            type: String,
            default: ''
        },
        uploadFile: {
          type: Function,
          default: () => {}
        },
        tools: {
            type: Array,
            default: () => []
        },
        bubbleMenu: {
            type: [Boolean, Object],
            default: false
        },
        focusVisible: {
            type: Boolean,
            default: true
        },
        autofocus: {
            type: [String, Number, Boolean],
            default: 'end'
        },
        editorContent: {
            type: Object,
            default: () => ({
                class: ['h-100', 'scroll-y']
            })
        }
    },
    methods: {
        onInput(value) {
            this.$emit('input', value);
        },
        onChange(value) {
            this.$emit('change', value);
        },
        getImageUrl() {
            return new Promise((resolve) => {
                const onChange = async (event) => {
                    const [file] = Array.from(event.target.files);
                    const { isError, error, result: imageUrl } = await this.uploadFile(file);

                    if (isError) {
                        console.error(error);
                        resolve(null);
                    }

                    resolve(imageUrl);
                };

                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = onChange.bind(this);
                input.click();
            });
        }
    }
};
</script>
