<template>
    <div class="ui-container" :class="cssClass">
        <template v-if="hasSlots">
            <div v-if="hasHeaderSlot" class="ui-container__header">
                <!--
                @slot header slot
                @example Header
                -->
                <slot name="header"></slot>
            </div>
            <div class="ui-container__content" :class="{ 'has-scroll': scroll }" ref="content">
                <!--
                @slot content slot
                @example Lorem ipsum dolor sit amet consectetur adipisicing elit. Earum consectetur ut doloremque similique voluptatum expedita cupiditate inventore neque laborum, officia ea eos, numquam aperiam iusto praesentium magnam repudiandae totam illum.
                -->
                <slot></slot>
            </div>
            <div v-if="hasFooterSlot" class="flex-shrink">
                <!--
                @slot footer slot
                @example Footer
                -->
                <slot name="footer"></slot>
            </div>
        </template>
        <template v-else>
            <slot></slot>
        </template>
    </div>
</template>
<script>
const Padding = {
    NONE: { name: 'none', class: [] },
    SMALL: { name: 'small', class: ['pad-3'] },
    NORMAL: { name: 'normal', class: ['pad-l1'] },
    LARGE: { name: 'large', class: ['pad-l3'] },
    XLARGE: { name: 'xlarge', class: ['pad-l4'] }
};

export default {
    props: {
        /**
         * @default none
         * @values none,small,normal,large,xlarge
         */
        padding: {
            type: String,
            default: Padding.NONE.name,
            validator: (val) =>
                Object.values(Padding)
                    .map(({ name }) => name)
                    .includes(val)
        },
        scroll: {
            type: Boolean,
            default: false
        },
        /**
         * @default undefined
         */
        onScroll: {
            type: Function
        }
    },
    computed: {
        hasHeaderSlot() {
            return this.$scopedSlots.header?.() != null;
        },
        hasFooterSlot() {
            return this.$scopedSlots.footer?.() != null;
        },
        hasSlots() {
            const { hasHeaderSlot, hasFooterSlot } = this;
            return hasHeaderSlot || hasFooterSlot;
        },
        cssClass() {
            const { padding, scroll, hasSlots } = this;
            const paddingDef = Object.values(Padding).find(({ name }) => name === padding);
            const classes = [...paddingDef.class];
            if (!hasSlots && scroll) {
                classes.push('has-scroll');
            }
            if (hasSlots) {
                classes.push('has-slots');
            }
            return classes;
        }
    },
    mounted() {
        this.disposals = [this.subscribeScroll()];
    },
    beforeDestroy() {
        this.disposals.forEach((disposal) => disposal());
    },
    methods: {
        subscribeScroll() {
            if (this.scroll === true && this.onScroll != null) {
                this.$refs.content.addEventListener('scroll', this.onScroll);
                return () => this.$refs.content.removeEventListener('scroll', this.onScroll);
            }
            return () => {};
        }
    }
};
</script>
<style scoped>
.ui-container {
    &__header {
        z-index: 1;
        flex: 0 1 auto;
    }
    &__content {
        position: relative;
        flex: 1 0 auto;
        &.has-scroll {
            overflow: auto;
            flex-basis: 0;
            /* 'contain' boosts scroll behaviour a lot */
            contain: strict;
        }
    }
}
.has-slots {
    display: flex;
    flex-direction: column;
}
.has-scroll {
    overflow: auto;
}
</style>
