import { IDatasetQuery, IDatasetRequestProps } from '../types.d.ts';
import { QueryFilterOperator, QuerySortDirection, QueryAggregateFunctionName } from './query-const';

export type FilterOperatorType = (typeof QueryFilterOperator)[keyof typeof QueryFilterOperator];
export type SortDirectionType = (typeof QuerySortDirection)[keyof typeof QuerySortDirection];

export interface IDatasetQueryFilter {
    [field: string]: {
        // @ts-ignore
        [operator: FilterOperatorType]: number[] | string[] | boolean[];
    };
}

export interface IDatasetQuerySort {
    [field: string]: SortDirectionType;
}

export type IDatasetQueryVariableValue = {
    value: string | number;
} | null;

export interface IDatasetQueryVariable {
    [field: string]: IDatasetQueryVariableValue;
}

export interface IQueryFilterInfo {
    name: string;
    operator: FilterOperatorType | string;
    value: number | number[] | string | string[] | boolean | boolean[] | null | null[];
}

export interface IQueryVariableInfo {
    name: string;
    value: number | string | null;
}

export interface IQuerySortInfo {
    name: string;
    direction: SortDirectionType | string;
}

export interface IDatasetQueryMetricCustom {
    name: string;
    definition: string;
}

export interface IQueryMetricCustomInfo {
    name: string;
    field: string;
    func: QueryAggregateFunctionName | string;
}

/**
 * @param {{ name:string, operator:string, value:array }} options
 * @returns {object}
 */
export function queryFilterCreate({ name, operator, value }: IQueryFilterInfo): IDatasetQueryFilter;

/**
 * @param {{ query:IDatasetQuery, filter:object|string }} options
 * @returns {number}
 */
export function queryFilterFindIndex({ query, filter }: { query: IDatasetQuery; filter: IDatasetQueryFilter }): number;

/**
 * @param {{ query:IDatasetQuery, filter:object|string }} options
 * @returns {boolean}
 */
export function queryFilterExists({
    query,
    filter
}: {
    query: IDatasetQuery;
    filter: IDatasetQueryFilter | IQueryFilterInfo['name'];
}): boolean;

/**
 * @param {string} operator
 * @param {string} value
 * @return {boolean}
 */
export function queryFilterIsValidInfo({ operator, value }: Omit<IQueryFilterInfo, 'name'>): boolean;

/**
 * @param {{ query:IDatasetQuery, filter:object }} options
 * @returns {IDatasetQuery}
 */
export function queryFilterUpdate({
    query,
    filter
}: {
    query: IDatasetQuery;
    filter: IDatasetQueryFilter;
}): IDatasetQuery;

/**
 * @param {{ query:IDatasetQuery, filter:object }} options
 * @param {boolean} [forceUpdate=true]
 * @returns {IDatasetQuery}
 */
// prettier-ignore
export function queryFilterAdd({
                                   query,
                                   filter
                               }: {
    query: IDatasetQuery,
    filter: IDatasetQueryFilter
}, forceUpdate = true): IDatasetQuery

/**
 * @param {{ query:IDatasetQuery, name:string }} options
 * @returns {IDatasetQuery}
 */
export function queryFilterRemove({
    query,
    filter
}: {
    query: IDatasetQuery;
    filter: IQueryFilterInfo['name'] | IDatasetQueryFilter;
}): IDatasetQuery;

/**
 *
 * @param {{ query:IDatasetQuery }} options
 * @returns {IDatasetQuery}
 */
export function queryFilterRemoveAll({ query }: { query: IDatasetQuery }): IDatasetQuery;

/**
 * @param {object} filter
 * @returns {{ name:string, operator:string, value:string }}
 */
export function queryFilterGetInfo(filter: IDatasetQueryFilter): IQueryFilterInfo;

////////////////////////////////
//
// Sort
//
////////////////////////////////

/**
 * @param {{ name:string, direction:string }} options
 * @returns {object}
 */
export function querySortCreate({ name, direction }: IQuerySortInfo): IDatasetQuerySort;

/**
 * @param {{ query:IDatasetQuery, sort:object }} options
 * @returns {number}
 */
export function querySortFindIndex({
    query,
    sort
}: {
    query: IDatasetQuery;
    sort: IDatasetQuerySort | IQuerySortInfo['name'];
}): number;

/**
 * @param {{ query:IDatasetQuery, sort:object }} options
 * @returns {boolean}
 */
export function querySortExists({
    query,
    sort
}: {
    query: IDatasetQuery;
    sort: IDatasetQuerySort | IQuerySortInfo['name'];
}): boolean;

/**
 * @param {{ query:IDatasetQuery, sort:object }} options
 * @returns {IDatasetQuery}
 */
export function querySortUpdate({ query, sort }: { query: IDatasetQuery; sort: IDatasetQuerySort }): IDatasetQuery;

/**
 * @param {{ query:IDatasetQuery, sort:object }} options
 * @param {boolean} [forceUpdate=true]
 * @returns {IDatasetQuery}
 */
export function querySortAdd(
    { query, sort }: { query: IDatasetQuery; sort: IDatasetQuerySort },
    forceUpdate = true
): IDatasetQuery;

/**
 *
 * @param {{ query:IDatasetQuery, sort:object }} options
 * @returns {IDatasetQuery}
 */
export function querySortRemove({
    query,
    sort
}: {
    query: IDatasetQuery;
    sort: string | IDatasetQuerySort;
}): IDatasetQuery;

/**
 *
 * @param {{ query:IDatasetQuery }} options
 * @returns {IDatasetQuery}
 */
export function querySortRemoveAll({ query }: { query: IDatasetQuery }): IDatasetQuery;

/**
 * @param {object} sort
 * @returns {{ name:string, direction:string }}
 */
export function querySortGetInfo(sort: IDatasetQuerySort): IQuerySortInfo;

////////////////////////////////
//
// Variables
//
////////////////////////////////
/**
 * @param {{ query:IDatasetQuery, variable: IQueryVariableInfo | IQueryVariableInfo['name']  }} options
 * @returns {number}
 */
export function queryVariableFindIndex({
    query,
    variable
}: {
    query: IDatasetQuery;
    variable: IQueryVariableInfo | IQueryVariableInfo['name'];
}): number;

/**
 * @param {{ query:IDatasetQuery, variable: IQueryVariableInfo | IQueryVariableInfo['name'] }} options
 * @returns {boolean}
 */
export function queryVariableExists({
    query,
    variable
}: {
    query: IDatasetQuery;
    variable: IQueryVariableInfo | IQueryVariableInfo['name'];
}): boolean;

export function queryVariableGetInfo(queryVariable: IDatasetQueryVariable): IQueryVariableInfo;

export function queryVariableCreate(queryVariableInfo: Partial<IQueryVariableInfo>): IDatasetQueryVariable;

export function queryVariableUpdate({
    query,
    variable
}: {
    query: IDatasetQuery;
    variable: IDatasetQueryVariable;
}): IDatasetQuery;

/**
 * @param {{ query:IDatasetQuery, variable: IDatasetQueryVariable }} options
 * @param {boolean} [forceUpdate=true]
 * @returns {IDatasetQuery}
 */
export function queryVariableAdd(
    { query, variable }: { query: IDatasetQuery; variable: IDatasetQueryVariable },
    forceUpdate = true
): IDatasetQuery;

/**
 *
 * @param {{ query:IDatasetQuery, variable: IDatasetQueryVariable | string }} options
 * @returns {IDatasetQuery}
 */
export function queryVariableRemove({
    query,
    variable
}: {
    query: IDatasetQuery;
    variable: IDatasetQueryVariable | string;
}): IDatasetQuery;

////////////////////////////////
//
// Custom metrics
//
////////////////////////////////

/**
 * @param {{ name:string, field:string, func:QueryAggregateFunctionName|string }} options
 * @returns {IDatasetQueryMetricCustom}
 */
export function queryMetricCustomCreate({ name, field, func }: IQueryMetricCustomInfo): IDatasetQueryMetricCustom;

/**
 * @param {{ query:IDatasetQuery, metric:IDatasetQueryMetricCustom|string }} options
 * @returns {number}
 */
export function queryMetricCustomFindIndex({
                                              query,
                                              metric
                                        }: {
    query: IDatasetQuery;
    metric: IDatasetQueryMetricCustom | IQueryMetricCustomInfo['name']
}): number;

/**
 * @param {{ query:IDatasetQuery, metric:IDatasetQueryMetricCustom|string }} options
 * @returns {boolean}
 */
export function queryMetricCustomExists({
                                      query,
                                      metric
                                  }: {
    query: IDatasetQuery;
    metric: IDatasetQueryMetricCustom | IQueryMetricCustomInfo['name'];
}): boolean;

/**
 * @param {{ query:IDatasetQuery, metric:IDatasetQueryMetricCustom }} options
 * @returns {IDatasetQuery}
 */
export function queryMetricCustomUpdate({
                                      query,
                                      metric
                                  }: {
    query: IDatasetQuery;
    metric: IDatasetQueryMetricCustom;
}): IDatasetQuery;

/**
 * @param {{ query:IDatasetQuery, metric:IDatasetQueryMetricCustom }} options
 * @param {boolean} [forceUpdate=true]
 * @returns {IDatasetQuery}
 */
// prettier-ignore
export function queryMetricCustomAdd({
                                   query,
                                   metric
                               }: {
    query: IDatasetQuery,
    metric: IDatasetQueryMetricCustom
}, forceUpdate = true): IDatasetQuery

/**
 * @param {{ query:IDatasetQuery, metric:IDatasetQueryMetricCustom|string }} options
 * @returns {IDatasetQuery}
 */
export function queryMetricCustomRemove({
                                      query,
                                      metric
                                  }: {
    query: IDatasetQuery;
    metric: IDatasetQueryMetricCustom | IQueryMetricCustomInfo['name'];
}): IDatasetQuery;

/**
 *
 * @param {{ query:IDatasetQuery }} options
 * @returns {IDatasetQuery}
 */
export function queryMetricCustomRemoveAll({ query }: { query: IDatasetQuery }): IDatasetQuery;

////////////////////////////////
//
// Query
//
////////////////////////////////

export function queryCreate(query?: Partial<IDatasetQuery>): IDatasetQuery;

export function queryCreateFromRequestProps({ query, datasetName }: { query: Partial<IDatasetQuery>, datasetName?: string }): IDatasetQuery;

/**
 * @param {{ query:IDatasetQuery }} options
 * @returns {IDatasetQuery}
 */
export function queryReplaceFilterPlaceholders({ query }: { query: IDatasetQuery }): IDatasetQuery;

export function queryFormatFiltersValues({ query }: { query: IDatasetQuery }): IDatasetQuery;
