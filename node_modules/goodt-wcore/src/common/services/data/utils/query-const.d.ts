import { dayjs } from '@goodt-common/utils';

export const QueryConst = {};

const DateFormat = {
    DATE: 'YYYY-MM-DD',
    TIME: 'HH:mm:ss',
    TIMESTAMP: 'YYYY-MM-DD HH:mm:ss'
};

/**
 * @static
 * @enum {string}
 */
export const QueryKey = {
    /** @member {string} */
    FIELDS: '$fields',
    /** @member {string} */
    FROM: '$from',
    /** @member {string} */
    METRICS: '$metrics',
    /** @member {string} */
    DIMENSIONS: '$dimensions',
    /** @member {string} */
    FILTERS: '$filters',
    /** @member {string} */
    VARIABLES: '$variables',
    /** @member {String} */
    METRICS_CUSTOM: '$metricsCustom',
    /** @member {string} */
    SORT: '$sort',
    /** @member {string} */
    ORDER: '$order'
};

export const QueryKeyRuntime = {
    /** @member {string} */
    DRILLDOWNS: '$drilldowns'
};

/**
 * @static
 * @enum {string}
 */
export const QuerySortDirection = {
    /** @member {string} */
    ASC: 'asc',
    /** @member {string} */
    DESC: 'desc'
};

export const QuerySortDirectionLabel = {
    [QuerySortDirection.ASC]: 'по возрастанию',
    [QuerySortDirection.DESC]: 'по убыванию'
};

/**
 * @static
 * @enum {string}
 */
export const QueryFilterOperator = {
    /**
     * equivalent of sql '='
     * @member {string}
     */
    EQ: '$eq',
    /**
     * equivalent of sql '!='
     * @member {string}
     */
    EQ_NOT: '$eqn',
    /**
     * equivalent of sql 'is'
     * @member {string}
     */
    IS: '$is',
    /**
     * equivalent of sql 'is not'
     * @member {string}
     */
    IS_NOT: '$isn',
    /**
     * equivalent of sql '<'
     * @member {string}
     */
    LESS: '$lt',
    /**
     * equivalent of sql '<='
     * @member {string}
     */
    LESS_EQ: '$ltq',
    /**
     * equivalent of sql '>'
     * @member {string}
     */
    GREATER: '$gt',
    /**
     * equivalent of sql '>='
     * @member {string}
     */
    GREATER_EQ: '$gtq',
    /**
     * equivalent of sql 'in()'
     * @member {string}
     */
    IN: '$in',
    /**
     * equivalent of sql 'not in()'
     * @member {string}
     */
    IN_NOT: '$inn',
    /**
     * equivalent of sql 'between()'
     * @member {string}
     */
    BETWEEN: '$btw',
    /**
     * equivalent of sql 'not between()'
     * @member {string}
     */
    BETWEEN_NOT: '$btwn',
    /**
     * equivalent of sql 'like()'
     * @member {string}
     */
    LIKE: '$lk'
};

export const QueryFilterOperatorLabel = {
    [QueryFilterOperator.EQ]: '=',
    [QueryFilterOperator.EQ_NOT]: '!=',
    [QueryFilterOperator.IS]: 'is',
    [QueryFilterOperator.IS_NOT]: 'is not',
    [QueryFilterOperator.LESS]: '<',
    [QueryFilterOperator.LESS_EQ]: '<=',
    [QueryFilterOperator.GREATER]: '>',
    [QueryFilterOperator.GREATER_EQ]: '>=',
    [QueryFilterOperator.IN]: 'in',
    [QueryFilterOperator.IN_NOT]: 'not in',
    [QueryFilterOperator.BETWEEN]: 'between',
    [QueryFilterOperator.BETWEEN_NOT]: 'not between',
    [QueryFilterOperator.LIKE]: 'like'
};

export const QueryFilterOperatorValidator = {
    [QueryFilterOperator.EQ]: (v) => v.length == 1,
    [QueryFilterOperator.EQ_NOT]: (v) => v.length == 1,
    [QueryFilterOperator.IS]: (v) => v.length == 1,
    [QueryFilterOperator.IS_NOT]: (v) => v.length == 1,
    [QueryFilterOperator.LESS]: (v) => v.length == 1,
    [QueryFilterOperator.LESS_EQ]: (v) => v.length == 1,
    [QueryFilterOperator.GREATER]: (v) => v.length == 1,
    [QueryFilterOperator.GREATER_EQ]: (v) => v.length == 1,
    [QueryFilterOperator.IN]: (v) => v.length > 0,
    [QueryFilterOperator.IN_NOT]: (v) => v.length > 0,
    [QueryFilterOperator.BETWEEN]: (v) => v.length == 2,
    [QueryFilterOperator.BETWEEN_NOT]: (v) => v.length == 2,
    [QueryFilterOperator.LIKE]: (v) => v.length > 0
};

/**
 * @static
 * @enum {string}
 */
export const QueryFilterPlaceholder = {
    /** @member {string} */
    YEAR_ROLLING: '#year-rolling#',
    /** @member {string} */
    YEAR_START: '#year-start#',
    /** @member {string} */
    YEAR_END: '#year-end#',
    /** @member {string} */
    YEAR_PREV_START: '#year-prev-start#',
    /** @member {string} */
    YEAR_PREV_END: '#year-prev-end#',

    /** @member {string} */
    QUARTER_START: '#quarter-start#',
    /** @member {string} */
    QUARTER_END: '#quarter-end#',
    /** @member {string} */
    QUARTER_PY_START: '#quarter-py-start#',
    /** @member {string} */
    QUARTER_PY_END: '#quarter-py-end#',
    /** @member {string} */
    QUARTER_PREV_START: '#quarter-prev-start#',
    /** @member {string} */
    QUARTER_PREV_END: '#quarter-prev-end#',

    /** @member {string} */
    MONTH_ROLLING: '#month-rolling#',
    /** @member {string} */
    MONTH_START: '#month-start#',
    /** @member {string} */
    MONTH_END: '#month-end#',
    /** @member {string} */
    MONTH_PY_START: '#month-py-start#',
    /** @member {string} */
    MONTH_PY_END: '#month-py-end#',
    /** @member {string} */
    MONTH_PREV_START: '#month-prev-start#',
    /** @member {string} */
    MONTH_PREV_END: '#month-prev-end#',

    /** @member {string} */
    WEEK_ROLLING: '#week-rolling#',
    /** @member {string} */
    WEEK_START: '#week-start#',
    /** @member {string} */
    WEEK_END: '#week-end#',
    /** @member {string} */
    WEEK_PY_START: '#week-py-start#',
    /** @member {string} */
    WEEK_PY_END: '#week-py-end#',
    /** @member {string} */
    WEEK_PREV_START: '#week-prev-start#',
    /** @member {string} */
    WEEK_PREV_END: '#week-prev-end#',

    /** @member {string} */
    TODAY: '#today#',
    /** @member {string} */
    YESTERDAY: '#yesterday#'
};

/**
 * @static
 * @enum {string}
 */
export const QueryFilterPlaceholderHandler = {
    /** @member {Function} */
    YEAR_ROLLING: () => dayjs().add(-365, 'd').format(DateFormat.DATE),
    /** @member {Function} */
    YEAR_START: () => dayjs().startOf('year').format(DateFormat.DATE),
    /** @member {Function} */
    YEAR_END: () => dayjs().endOf('year').format(DateFormat.DATE),
    /** @member {Function} */
    YEAR_PREV_START: () => dayjs().add(-1, 'y').startOf('year').format(DateFormat.DATE),
    /** @member {Function} */
    YEAR_PREV_END: () => dayjs().add(-1, 'y').endOf('year').format(DateFormat.DATE),

    /** @member {Function} */
    QUARTER_START: () => dayjs().startOf('Q').format(DateFormat.DATE),
    /** @member {Function} */
    QUARTER_END: () => dayjs().endOf('Q').format(DateFormat.DATE),
    /** @member {Function} */
    QUARTER_PY_START: () => dayjs().add(-1, 'y').startOf('Q').format(DateFormat.DATE),
    /** @member {Function} */
    QUARTER_PY_END: () => dayjs().add(-1, 'y').endOf('Q').format(DateFormat.DATE),
    /** @member {Function} */
    QUARTER_PREV_START: () => dayjs().add(-1, 'Q').startOf('Q').format(DateFormat.DATE),
    /** @member {Function} */
    QUARTER_PREV_END: () => dayjs().add(-1, 'Q').endOf('Q').format(DateFormat.DATE),

    /** @member {Function} */
    MONTH_ROLLING: () => dayjs().add(-30, 'd').format(DateFormat.DATE),
    /** @member {Function} */
    MONTH_START: () => dayjs().startOf('month').format(DateFormat.DATE),
    /** @member {Function} */
    MONTH_END: () => dayjs().endOf('month').format(DateFormat.DATE),
    /** @member {Function} */
    MONTH_PY_START: () => dayjs().add(-1, 'y').startOf('month').format(DateFormat.DATE),
    /** @member {Function} */
    MONTH_PY_END: () => dayjs().add(-1, 'y').endOf('month').format(DateFormat.DATE),
    /** @member {Function} */
    MONTH_PREV_START: () => dayjs().add(-1, 'M').startOf('month').format(DateFormat.DATE),
    /** @member {Function} */
    MONTH_PREV_END: () => dayjs().add(-1, 'M').endOf('month').format(DateFormat.DATE),

    /** @member {Function} */
    WEEK_ROLLING: () => dayjs().add(-7, 'd').format(DateFormat.DATE),
    /** @member {Function} */
    WEEK_START: () => dayjs().startOf('isoWeek').format(DateFormat.DATE),
    /** @member {Function} */
    WEEK_END: () => dayjs().endOf('isoWeek').format(DateFormat.DATE),
    /** @member {Function} */
    WEEK_PY_START: () => dayjs().add(-1, 'y').startOf('isoWeek').format(DateFormat.DATE),
    /** @member {Function} */
    WEEK_PY_END: () => dayjs().add(-1, 'y').endOf('isoWeek').format(DateFormat.DATE),
    /** @member {Function} */
    WEEK_PREV_START: () => dayjs().startOf('isoWeek').add(-1, 'd').startOf('isoWeek').format(DateFormat.DATE),
    /** @member {Function} */
    WEEK_PREV_END: () => dayjs().startOf('isoWeek').add(-1, 'd').endOf('isoWeek').format(DateFormat.DATE),

    /** @member {Function} */
    TODAY: () => dayjs().format(DateFormat.DATE),
    /** @member {Function} */
    YESTERDAY: () => dayjs().add(-1, 'd').format(DateFormat.DATE)
};

/**
 * @static
 * @enum {String}
 */
export const QueryAggregateFunctionName = {
    /**
     * no aggregation
     * @member {String}
     */
    VALUE: 'value',
    /**
     * equivalent of sql 'avg()'
     * @member {String}
     */
    AVG: 'avg',
    /**
     * equivalent of sql 'count()'
     * @member {String}
     */
    COUNT: 'count',
    /**
     * equivalent of sql 'max()'
     * @member {String}
     */
    MAX: 'max',
    /**
     * equivalent of sql 'min()'
     * @member {String}
     */
    MIN: 'min',
    /**
     * equivalent of sql 'sum()'
     * @member {String}
     */
    SUM: 'sum',
    /**
     * equivalent of mysql 'group_concat()'
     * @member {String}
     */
    GROUP_CONCAT: 'group_concat',
    /**
     * equivalent of mysql 'group_concat(distinct)'
     * @member {String}
     */
    GROUP_UCONCAT: 'group_uconcat'
};

// eslint-disable-next-line no-shadow
export enum QueryFilterOperator {
    EQ = '$eq',
    EQ_NOT = '$eqn',
    LESS = '$lt',
    LESS_EQ = '$ltq',
    GREATER = '$gt',
    GREATER_EQ = '$gtq',
    IN = '$in',
    IN_NOT = '$inn',
    BETWEEN = '$btw',
    BETWEEN_NOT = '$btwn',
    LIKE = '$lk'
}

// eslint-disable-next-line no-shadow
export enum QuerySortDirection {
    ASC = 'asc',
    DESC = 'desc'
}

export enum QueryAggregateFunctionName {
    VALUE = 'value',
    AVG = 'avg',
    COUNT = 'count',
    MAX = 'max',
    MIN = 'min',
    SUM = 'sum',
    GROUP_CONCAT = 'group_concat',
    GROUP_UCONCAT = 'group_uconcat'
}
