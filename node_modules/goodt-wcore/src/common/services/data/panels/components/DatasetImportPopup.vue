<template>
    <ui-popup :visible="show" @close="$emit('close')">
        <template #body>
            <div class="w-f3 mar-top-l1 p pos-rel">
                <textarea v-model="datasetJson" class="textarea textarea-small w-100" placeholder="{dataset json}" />
                <div v-if="datasetJson && datasetJsonError" class="alert alert-error mar-top-3">
                    <div class="alert-body text-xsmall">
                        {{ datasetJsonError }}
                    </div>
                </div>
                <button class="btn btn-small btn-ghost color-grey pos-abs pos-top-right w-0" title="Вставить из буфера" @click="onClipboardPaste">
                    <span class="icon">
                        <i class="mdi mdi-18px mdi-clipboard-text-outline" />
                    </span>
                </button>
            </div>
            <div class="d-flex flex-h-end flex-v-center">
                <button class="btn btn-primary" :disabled="!isSaveAvailable" @click="importDataset">Сохранить</button>
            </div>
        </template>
    </ui-popup>
</template>
<script>
import { Popup as UiPopup, UiButton } from '@goodt-wcore/components';

export default {
    components: {
        UiPopup,
        UiButton
    },
    props: {
        show: {
            type: Boolean
        }
    },
    data() {
        return {
            datasetJson: ''
        };
    },
    computed: {
        datasetJsonError() {
            const { datasetJson } = this;
            if (datasetJson == null || datasetJson === '') {
                return null;
            }
            try {
                JSON.parse(datasetJson);
                return null;
            } catch (error) {
                return error;
            }
        },
        isSaveAvailable() {
            const { datasetJson } = this;
            return this.datasetJsonError === null && datasetJson != null && datasetJson !== '';
        }
    },
    methods: {
        importDataset() {
            this.$emit('import', JSON.parse(this.datasetJson));
            this.datasetJson = '';
        },
        async onClipboardPaste() {
            try {
                this.datasetJson = await navigator.clipboard.readText();
            } catch {
                //
            }
        }
    }
};
</script>
<style lang="pcss" scoped>
.textarea {
    min-height: 15rem;
}
</style>
