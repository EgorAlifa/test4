<template>
    <div class="card pad-l2 pad-top-l1">
        <template v-if="meta">
            <div class="card__header">
                <h2 class="last">{{ meta.dataset.name }}</h2>
                <div class="text-muted text-small">{{ formatDate(meta.dataset.dateFrom) }}</div>
            </div>
            <div class="card__body">
                <div v-if="meta.dataset.description">{{ meta.dataset.description }}</div>
                <div>
                    <b>Автор</b>
                    <div class="text-truncate">
                        <template v-if="meta.dataset.authorKeycloakPreferredUsername">
                            {{ meta.dataset.authorKeycloakPreferredUsername }}
                        </template>
                        <template v-else>unnamed</template>
                    </div>
                </div>
                <div>
                    <b>Метрики</b>
                    <div>
                        <ui-entity class="mar-right-3" v-for="{ id, name } in meta.metrics" :key="id" type="metric">
                            {{ name }}
                        </ui-entity>
                    </div>
                </div>
                <div>
                    <b>Измерения</b>
                    <div>
                        <ui-entity
                            class="mar-right-3"
                            v-for="{ id, name } in meta.dimensions"
                            :key="id"
                            type="dimension">
                            {{ name }}
                        </ui-entity>
                    </div>
                </div>
                <div class="scroll-x">
                    <div class="preloader mar-l1" v-if="isLoading"></div>
                    <table class="table table-borders table-hover w-100 text-small" v-else>
                        <thead>
                            <tr>
                                <th>Поле</th>
                                <th class="table-w-auto">Тип</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="field in meta.dataset.schema.fields" :key="field.name">
                                <td class="text-truncate" :title="field.name">{{ field.name }}</td>
                                <td>
                                    <code>{{ field.type }}</code>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card__footer">
                <button class="btn btn-primary" @click="onSelectClick">Выбрать</button>
            </div>
        </template>
        <template v-else>
            <div class="preloader"></div>
        </template>
    </div>
</template>
<script>
import { dayjs } from '@goodt-common/utils';
import UiEntity from '../../shared/EntityBadge.vue';

/**
 * @typedef {import('../../../../types').IDatasetMeta} IDatasetMeta
 */
export default {
    components: { UiEntity },
    props: {
        /** @type {import('vue').PropOptions<IDatasetMeta>} */
        meta: {
            type: Object,
            default: null
        },
        isLoading: { type: Boolean, default: false }
    },
    methods: {
        onSelectClick() {
            this.$emit('select');
        },
        formatDate(dateStr) {
            return dayjs(dateStr).format('DD.MM.YYYY, HH:mm');
        }
    }
};
</script>
<style lang="less" scoped>
.card {
    display: flex;
    flex-direction: column;
    width: 25rem;
    height: 100%;
    &__header {
        padding-bottom: 1rem;
    }
    &__body {
        display: flex;
        flex-direction: column;
        flex: 1 0 auto;
        height: 0;
        gap: 1.5rem;
        overflow-y: auto;
    }
    &__footer {
        text-align: right;
        padding-top: 1rem;
    }
}
</style>
