<template>
    <div class="header-cell">
        <sup class="pos-abs color-grey">{{ letter }}</sup>
        <div class="header-cell__label text-nowrap">
            <slot v-bind="{ isSorted: sortDirection != null, isSortable, toggleSort }"></slot>
            <template v-if="isSortable && sortDirection != null">
                <ui-icon
                    :name="
                        sortDirection === QuerySortDirection.ASC
                            ? 'sort-alphabetical-ascending'
                            : 'sort-alphabetical-descending'
                    "
                    :box="false"
                    size="small"
                    class="mar-left-1"></ui-icon>
            </template>
        </div>
        <span class="color-grey text-xsmall" v-if="$slots.type">
            <slot name="type"></slot>
        </span>
        <span v-else class="header-cell__type-skeleton skeleton skeleton-small"></span>
        <template v-if="canFilter">
            <ui-icon
                :id="filterId"
                name="filter"
                size="small"
                :box="false"
                :disabled="isLoading"
                :class="[isFiltered ? 'color-primary' : 'color-grey-light']"
                @click="onFilterClick"></ui-icon>
        </template>
    </div>
</template>
<script>
import { UiIcon } from '@goodt-wcore/components';
import { QuerySortDirection } from '../../../../utils/query-const';

export default {
    components: {
        UiIcon
    },
    props: {
        canFilter: { type: Boolean, default: false },
        isLoading: { type: Boolean, default: false },
        isFiltered: { type: Boolean, default: false },
        isSortable: { type: Boolean, default: false },
        sortDirection: { type: String, default: null },
        letter: { type: String, default: '' }
    },
    computed: {
        filterId() {
            return `dataset-header-${this.letter}-filter`;
        }
    },
    static: { QuerySortDirection },
    methods: {
        toggleSort() {
            const { ASC, DESC } = QuerySortDirection;
            const { sortDirection } = this;
            let newDirection = null;
            if (sortDirection === ASC) {
                newDirection = DESC;
            } else if (sortDirection === DESC) {
                newDirection = null;
            } else {
                newDirection = ASC;
            }
            this.$emit('sort-change', newDirection);
        },
        onFilterClick() {
            this.$emit('filter-change', `#${this.filterId}`);
        }
    }
};
</script>
<style lang="less" scoped>
.header-cell {
    position: relative;
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 0.5rem;

    &__label {
        height: 1.2rem;
        line-height: 1.2rem;
        gap: 0.25rem;
    }

    &__type-skeleton {
        display: inline-block;
        width: 4rem;
        height: 1rem;
    }
}
</style>
