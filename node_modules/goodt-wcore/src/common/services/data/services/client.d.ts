import { ITransport, ITransportOptions, ITransportResponse } from '@goodt-wcore/net';
import { IDatasetRequest, IDatasetResult } from '../types';

export type DataClientConfig = {
    isAdmin: boolean;
    processResponseError: (error: Error) => Error;
    processResponseResult: (result: IDatasetResult) => IDatasetResult;
};

export interface IDatasetRequestOptions {
    offset?: number;
    debug?: boolean;
}

export interface IRequestAction {
    url: string;
    options?: ITransportOptions;
}

export class DataClient {
    /**
     * @private
     * @type {ITransport}
     */
    private _transport: ITransport;

    /** @type {DataClientConfig} */
    config: DataClientConfig;

    /**
     * Constructor
     * @param {DataClientConfig} [config] config
     */
    constructor(config?: DataClientConfig);

    /**
     * @param {IDatasetRequest} datasetRequest
     * @param {{ offset:number, debug:boolean }} options
     * @return {Promise<IDatasetResult>}
     */
    getData({ query, url, limit = 10 }: IDatasetRequest, { offset = 0, debug = false }: IDatasetRequestOptions): Promise<IDatasetResult>;

    cancelActiveRequests();

    /**
     *
     * @param action
     * @param baseURL
     * @param params
     * @param pathParams
     * @param options
     */
    requestAction({
        action,
        baseURL = '',
        params = {},
        pathParams = {},
        options = {}
    }: {
        action: IRequestAction;
        baseURL: string;
        params: Record<string, any>;
        pathParams: Record<string, string | number>;
    }): Promise<ITransportResponse>;
}

export function createDatasetClient(config: DataClientConfig): DataClient;

export function DatasetClientFactory(config: DataClientConfig): DataClient;