// LIBS
const { merge } = require('webpack-merge');
// PLUGINS
const createOptimizationDefault  = require('@goodt-webpack/common/optimization');
const createOptimizationRemote  = require('./optimization');
// CONFIGS
const commonConfig = require('./webpack.common.js');
const path = require('path');


const productionConfig = ({
  // useShared, // 'shared', 'external'
  projectDir,
  packageJson = require(path.join(projectDir, 'package.json')),
}) => {

  const optimization = createOptimizationDefault();
  const optimizationRemote = createOptimizationRemote({ packageJson });

  optimization.splitChunks.cacheGroups = {
    ...optimization.splitChunks.cacheGroups,
    ...optimizationRemote.splitChunks.cacheGroups
  };

  return {
    optimization
  };
};

module.exports = (config) => merge(commonConfig(config), productionConfig(config));
