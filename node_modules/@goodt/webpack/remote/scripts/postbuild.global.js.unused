const { readFile, writeFile } = require('fs');
const { join } = require('path');

const remoteEntryFilePath = join(process.cwd(), 'dist/remoteEntry.js');

readFile(remoteEntryFilePath, (err, content) => {
  if (err) {
    throw err;
  }

  writeFile(remoteEntryFilePath, wrapContent(content), (err) => {
    if (err) {
      throw err;
    }

    console.log(`'${remoteEntryFilePath}' successfully patched`);
  });
});

const wrapContent = (content) => `/*
 * It is modification of originally auto-genertated with WMF 'remoteEntry.js' 
 * It adds custom IIEF wrapper with extra service call
 * to register 'module' in global window with runtime unique identifier 
 * related to module package's 'scope' extracted from <script> tag attributes 
 */
(() => { // @goodt-generated content
  ${content};
  window.__GOODT__.WMF.registerModule(Widget); // @goodt-generated content
})(); // @goodt-generated content
`;