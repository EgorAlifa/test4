const loaderUtils = require('loader-utils');

module.exports = function(source) {
    const { ns } = this.query;
    let sourceAddon = '';
    const params = loaderUtils.parseQuery(this.resourceQuery);
    // scoped styles only
    if (params.type === 'style' && params.scoped) {
        sourceAddon = `if(window) { window.${ns} = window.${ns} || {}; window.${ns}["${params.id}"] = content.toString(); }`;
    }
    return sourceAddon ? `${source}; ${sourceAddon}` : source;
};
