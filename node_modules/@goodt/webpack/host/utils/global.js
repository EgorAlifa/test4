/**
 * Global Scope Shared functions
 * related with WMF
 */

/**
 * Get current scope from `document.currentScript` attr `data-wfm-scope`
 * @returns {string}
 */
const getCurrentScope = () => {
    const { SCOPE_ATTR } = window.__GOODT__.WMF;
    return document.currentScript.getAttribute(SCOPE_ATTR);
};

/**
 * Get current module from `document.currentScript` attr `data-wfm-module`
 * Required only by Global Scope Remotes
 *
 * @returns {string}
 */
const getCurrentModule = () => {
    const { MODULE_ATTR, getCurrentScope, buildModuleScopedName } = window.__GOODT__.WMF;
    const scope = getCurrentScope();
    const module = document.currentScript.getAttribute(MODULE_ATTR);

    return buildModuleScopedName(scope, module);
};

/**
 * Registers remote module in Global Scope
 * Required only by Global Scope Remotes
 *
 * @returns {string}
 */
const registerModule = (module) => {
    window[getCurrentModule()] = module;
};

/**
 * Build module's scoped name to achieve module id uniqueness in Global Scope
 * Required only by Global Scope Remotes * @param {string} scope
 *
 * @param {string} module
 * @returns ${string}
 */
const buildModuleScopedName = (scope, module = 'Server') => {
    return `${scope}_${module}`;
};

window.__GOODT__.WMF = Object.assign({
    getCurrentScope,
    getCurrentModule,
    buildModuleScopedName,
    registerModule,
    SCOPE_ATTR: 'data-wfm-scope',
    MODULE_ATTR: 'data-wfm-module'
}, window.__GOODT__.WMF);

