const { isProd, argv } = require('@goodt-webpack/common/utils');
const { ARGV_SOURCE_MAP, OUTPUT_DIR } = require('@goodt-webpack/common/const');
const transpileDependencies = require('./config/transpileDependencies');
const path = require('path');

module.exports.build = ({
    projectDir,
    packageJson = require(path.join(projectDir, 'package.json')),
}) => ({
    publicPath: 'auto',
    outputDir: OUTPUT_DIR,
    productionSourceMap: isProd() === false || String(argv(ARGV_SOURCE_MAP)).includes(packageJson.name),
    filenameHashing: true,
    // @NOTE this should be false as we use shadowMode
    css: {
        // "extract: true" fails WMF DynamicContainerPathPlugin
        extract: false,
        sourceMap: false
    },
    transpileDependencies
});