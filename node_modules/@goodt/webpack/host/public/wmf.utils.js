/**
 * Global Scope Shared functions
 * related with WMF
 */

/**
 * Import (load) remote module with specified `url`
 * using native `import` or esm-shim depending on global `__GOODT__.ENV_CONFIG`
 *
 * @param {string} url
 * @returns {*|Promise<*>}
 */
const importModule = (url) => {
    return window.__GOODT__.WMF.ENV_CONFIG.isEsmShim
      ? window.importShim(url)
      : import(/* webpackIgnore: true */url);
}

const $container = () => window.document.querySelector('head');

/**
 * Load script by adding
 * `script` tag with defined `url`, `type` to document head
 * with extra tag attrs data-wmf-scope, data-wmf-scope required by Global Scope Remotes
 *
 * @param {string} url
 * @param {string} type
 * @param {string} scope
 * @param {string} module
 * @returns {Promise<unknown>}
 */
const appendScript = (url, { type = 'text/javascript', scope, module } = {}) => new Promise((resolve) => {
    const script = document.createElement('script');
    script.async = true;
    script.type = type;
    if (typeof scope === 'string') {
        script.setAttribute(window.__GOODT__.WMF.SCOPE_ATTR, scope);
    }
    if (typeof module === 'string') {
        script.setAttribute(window.__GOODT__.WMF.MODULE_ATTR, module);
    }
    script.onload = function (src) {
        resolve();
    };
    script.src = url;
    $container().appendChild(script);
});

window.__GOODT__ = Object.assign({}, window.__GOODT__);
window.__GOODT__.WMF = Object.assign({
    appendScript,
    importModule
}, window.__GOODT__.WMF);

