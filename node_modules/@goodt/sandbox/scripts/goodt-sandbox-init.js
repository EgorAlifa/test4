#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

const BASE_DIR = process.cwd();
const CONFIG_DIR = './sandbox/config';

const writeConfig = (targetFilePathRelative, configJson) => {
    fs.writeFileSync(
        path.join(BASE_DIR, targetFilePathRelative),
        JSON.stringify(configJson, null, 4),
        { encoding: 'utf-8' })
}

// ./sandbox/config/sandbox.local.json
const sandboxConfig = require(path.join(BASE_DIR, CONFIG_DIR, 'sandbox.json'));
sandboxConfig.widgets.$ref = 'widgets.local.json#/';
writeConfig('./sandbox/config/sandbox.local.json', sandboxConfig);

// ./sandbox/config/widgets.local.json
const widgetsConfig = require(path.join(BASE_DIR, CONFIG_DIR, 'widgets.json'));
writeConfig('./sandbox/config/widgets.local.json', widgetsConfig);

// ./sandbox/config/platform.local.json
try {
    const platformConfig = require(path.join(BASE_DIR, CONFIG_DIR, 'platform.json'));
    const packageJson = require(path.join(BASE_DIR, 'package.json'));
    platformConfig.platform.url = packageJson.vendorOptions?.platformUrl ?? 'http://localhost:3002/';
    writeConfig('./sandbox/config/platform.local.json', platformConfig);
} catch {
    /**/
}

// ./sandbox/config/platform/widgets.local.json
try {
    const platformWidgetsConfig = require(path.join(BASE_DIR, CONFIG_DIR, 'package', 'widgets.json'));
    writeConfig('./sandbox/config/package/widgets.local.json', platformWidgetsConfig);
} catch {
    /**/
}

// ./sandbox/config/platform/widgets.local.json
try {
    const platformWidgetsConfig = require(path.join(BASE_DIR, './public/config/package/widgets.local.json'));
    writeConfig('./sandbox/config/package/widgets.local.json', platformWidgetsConfig);
} catch {
    /**/
}


