const twIgnoredClasses = require('@goodt/postcss-config/tw-ignored-classes');

const composesClassesExtract = (content) => {
    const result = content.matchAll(/composes:\s+((([A-Za-z0-9\-_/:]*[A-Za-z0-9\-_/]+)\s+)+)from/g);
    return [...result].flatMap(([, match]) => match.split(/\s+/)).filter(Boolean);
};

module.exports = {
    // Learn more on https://tailwindcss.com/docs/controlling-file-size/#removing-unused-css
    purge: {
        enabled: true,
        content: ['./src/**/*.{vue,js,css,pcss,less}'],
        extract: {
            vue: (content) => content.match(/[A-Za-z0-9-_/:]*[A-Za-z0-9-_/]+/g) || [],
            css: composesClassesExtract,
            pcss: composesClassesExtract,
            less: composesClassesExtract
        },
        options: {
            blocklist: [...twIgnoredClasses.classes.map((selector) => selector.replace('.', ''))]
        }
    }
};
