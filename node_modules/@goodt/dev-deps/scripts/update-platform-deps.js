#!/usr/bin/env node
const path = require('path');
const fs = require('fs');
const url = require('node:url');

// CONSTANTS
const BASE_DIR = process.cwd();

const packageJsonPath = path.join(BASE_DIR, 'package.json');
const packageJson = require(packageJsonPath);

if (packageJson.vendorOptions?.platformUrl == null) {
    throw new Error(`package.json vendorOptions.platformUrl is not specified. Specify url where editor is deployed`);
}

const platformDepsUrl = new URL(packageJson.vendorOptions.platformUrl);
platformDepsUrl.pathname = path.join(platformDepsUrl.pathname, 'platform.dependencies.json');
console.log('Updating dependencies from', platformDepsUrl.toString());

fetch(platformDepsUrl)
    .then((response) => response.json())
    .then((json) => {
        const { dependencies, devDependencies } = json;
        packageJson.dependencies = { ...packageJson.dependencies, ...dependencies };
        packageJson.devDependencies = { ...packageJson.devDependencies, ...devDependencies };

        fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 4), { encoding: 'utf-8' });
    });


