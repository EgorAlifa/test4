<template>
    <w-elem>
        <h1>{{ title }}</h1>
        [[#hasTransport]] [[#tips]]
        <!-- {demo} @todo: DELETE COMMENTS -->
        <template v-if="demoResult">
            <pre v-if="demoResult.isSuccess">{{ demoResult.result }}</pre>
            <pre v-if="demoResult.isError" class="color-red">{{ demoResult.error.message }}</pre>
        </template>
        <template v-else>
            <div>No result yet</div>
        </template>
        <button
            class="btn btn-primary btn-small"
            :class="{ 'btn-loading events-none': isLoading }"
            @click="fetchDemoData">
            send demo request
        </button>
        <!-- {/demo} -->
        [[/tips]] [[/hasTransport]]
    </w-elem>
</template>

<script>
import { Elem } from '@goodt-wcore/elem';
[[#hasTransport]]
import {
    ApiMixins,
    ApiMixinsTypeDescriptor
} from './api';
[[/hasTransport]]
import { meta, Vars, Events } from './descriptor';
import { ElemInstanceTypeDescriptor } from './types';

export default {
    extends: Elem,
    [[#hasTransport]]
    mixins: [ ...ApiMixins ],
    [[/hasTransport]]

    meta,

    /**
     * Static data definition
     * @see https://docs.goodt.me/front/#/widget/elem/api/?id=widget-elem-api-opt-static
     */
    static: {},
    data: () => ({
        /**
         * @public
         */
        [[#hasTransport]]
        [[#tips]]
        isLoading: false,
        /**
         * @type {import('[[{commonUtils}]]').ISafeResult}
         */
        demoResult: null
        [[/tips]]
        [[/hasTransport]]
    }),
    computed: {},
    /**
     * Computed only in editor and become static in player
     * @see https://docs.goodt.me/front/#/widget/elem/api/?id=widget-elem-api-opt-computed-editor
     */
    computedEditor: {
        title() {
            return this.props.title;
        }
    },
    [[#tips]]
    [[/tips]]
    [[#tips]]
    /**
     * Store vars watchers definition
     * @see https://docs.goodt.me/front/#/widget/elem/api/?id=widget-elem-api-opt-watch-store
     */
    [[/tips]]
    watchStore: [
    [[#tips]]
        // @todo: DELETE DEMO STUFF
        {
            vars: [Vars.FOO],
            handler([ foo ], state) {
                /* todo: implement */
                console.log('state changed', { foo }, { state });

            }
        },
        {
            // any changed and both are not undefined
            all: true,
            vars: [Vars.FOO, Vars.BAR],
            handler([ foo, bar ], state) {
                /* todo: implement */
                console.log('[all] FOO-BAR.changed', { foo, bar }, { state } );
            }
        },
        {
            // anything changed in $storeState
            handler(_, state) {
                /* todo: implement */
            }
        },
        {
            // dynamic vars
            vars() {
                return this.props.shouldWatchStore ? [Vars.FOO, Vars.BAR] : [];
            },
            handler([ foo, bar ]) {
                /* todo: implement */
            }
        }
    [[/tips]]
    ],
    [[#tips]]
    watch: {},
    /**
     * Watchers enabled only in editor
     * @see https://docs.goodt.me/front/#/widget/elem/api/?id=widget-elem-api-opt-watch-editor
     */
    [[/tips]]
    watchEditor: {},
    [[#tips]]
    /**
     * @see https://docs.goodt.me/front/#/widget/elem/api/?id=widget-elem-api-opt-subscribe
     */
    [[/tips]]
    subscribe: [
    [[#tips]]
        // @todo: DELETE DEMO STUFF
        {
            event: Events.OPEN,
            handler(event, data) {
                console.log({ event, data });
            }
        },
        // @todo: DELETE DEMO STUFF
        {
            event: [Events.OPEN, Events.CLOSE],
            handler(event, data) {
                console.log({ event, data });
            }
        },
        // @todo: DELETE DEMO STUFF
        // dynamyc events
        {
            event() {
                return this.props.customEventsList;
            },
            handler(event, data) {
                console.log({ event, data });
            }
        }
    [[/tips]]
    ],
    [[#tips]]
    /**
     * Computed reactive only in editor, static in player
     * @see https://docs.goodt.me/front/#/widget/elem/api/?id=widget-elem-api-opt-computed-editor
     */
    [[/tips]]
    methods: {
        /* Vetur HACK for type hinting */
        ...ApiMixinsTypeDescriptor,
        ...ElemInstanceTypeDescriptor,
        [[#hasTransport]]
        [[#tips]]
        async fetchDemoData() {
            this.isLoading = true;
            this.demoResult = await this.orgStructureApiService.getEmployeeDivisionTeamAssignments({ employeeId: 25 });
            /*
            this.demoResult = await this.apiService.getUserById(1);
            */
            this.isLoading = false;
            const { isSuccess, isError, result: employeeAssignments, error } = this.demoResult;
            if (isError) {
                this.handleError(error);
                return;
            }
            if (isSuccess) {
                console.log({ employeeAssignments });
            }
        }
        [[/tips]]
        [[/hasTransport]]
    }
};
</script>

<style lang="pcss" scoped src="./style.pcss"></style>