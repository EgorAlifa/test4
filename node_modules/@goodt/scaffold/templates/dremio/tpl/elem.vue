<template>
    <w-elem>
        <!-- {demo} -->
        <code>{{ type }}</code>
        <div v-if="isEditorMode">running in editor</div>
        <div v-if="result">
            <pre v-for="(item, i) in result.rows" :key="i">{{ item }}</pre>
        </div>
        <div v-if="loading">loading</div>
        <div v-if="error">{{ error }}</div>
        <div v-if="!props.dremio">no dataset selected</div>
        <ul class="pagination" v-if="pages > 1">
            <li v-for="n in pages" :key="n" :class="{ active: n === page }">
                <a href="#" @click.stop="loadDataPage(n)">{{ n }}</a>
            </li>
        </ul>
        <!-- {/demo} -->
    </w-elem>
</template>
<script>
import { Elem } from '@goodt-wcore/elem';
import { mixin as DremioMixin } from '@goodt-common/dremio';
import { meta /*, Vars */ } from './descriptor';
import { ElemInstanceTypeDescriptor } from './types';

export default {
    extends: Elem,
    mixins: [ DremioMixin ],
    meta,
    data: (/* vm */) => ({
        loadDataHooks: {
            /* @todo: delete if unused
            // then – optional hook
            then: (result) => result,
            // before – optional hook
            before: (cancel) => {
                // use cancel() to prevent loading
                vm.loading = true; // if 'before' not defined this is default behaviour
            },
            // finally – optional hook
            finally: () => {
                vm.loading = false; // if 'finally' not defined this is default behaviour
            }
            */
        }
    }),
    methods: {
        /* IDE helper */
        ...ElemInstanceTypeDescriptor,
        loadDataPage(page) {
            this.page = page;
            this.loadData();
        }
    }
};
</script>
