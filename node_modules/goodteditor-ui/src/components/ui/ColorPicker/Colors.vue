<template>
    <div class="ui-color-picker-colors">
        <div class="colors">
            <div
                class="item shadow"
                v-for="item in colorsDefault"
                :key="item"
                @click="selectColor(item)"
            >
                <div
                    class="alpha"
                    :style="{ background: `url(${imgAlphaBase64})` }"
                />
                <div class="color" :style="{ background: item }" />
            </div>
        </div>
        <template v-if="colorsHistory.length">
            <hr class="mar-top-3 mar-bot-3" />
            <div class="colors">
                <div
                    class="item shadow"
                    v-for="item in colorsHistory"
                    :key="item"
                    @click="selectColor(item)"
                >
                    <div
                        class="alpha"
                        :style="{ background: `url(${imgAlphaBase64})` }"
                    />
                    <div class="color" :style="{ background: item }" />
                </div>
            </div>
        </template>
    </div>
</template>
<style lang="less" scoped>
.colors {
    display: grid;
    gap: 0.25em;
    grid-template-columns: repeat(auto-fill, minmax(1em, 1fr));

    .item {
        position: relative;
        width: 100%;
        height: 1em;
        transition: all 0.1s;
        cursor: pointer;
        &:hover {
            transform: scale(1.25);
        }
        .alpha,
        .color {
            height: 100%;
        }
        .alpha {
            position: absolute;
        }
        .color {
            position: relative;
        }
    }
}
</style>
<script>
import { createAlphaSquare } from './utils';
export default {
    props: {
        color: {
            type: String,
            default: '#000000'
        },
        colorsDefault: {
            type: Array,
            default: () => []
        },
        colorsHistoryKey: {
            type: String,
            default: ''
        }
    },
    data() {
        return {
            imgAlphaBase64: '',
            colorsHistory:
                JSON.parse(localStorage.getItem(this.colorsHistoryKey)) || []
        };
    },
    created() {
        this.imgAlphaBase64 = createAlphaSquare(4).toDataURL();
    },
    destroyed() {
        this.setColorsHistory(this.color);
    },
    methods: {
        selectColor(color) {
            this.$emit('selectColor', color);
        },
        setColorsHistory(color) {
            if (!color) {
                return;
            }
            const colors = this.colorsHistory;
            const index = colors.indexOf(color);
            if (index >= 0) {
                colors.splice(index, 1);
            }
            if (colors.length >= 8) {
                colors.length = 7;
            }
            colors.unshift(color);
            this.colorsHistory = colors;
            localStorage.setItem(this.colorsHistoryKey, JSON.stringify(colors));
        }
    }
};
</script>
