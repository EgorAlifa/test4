<template>
    <div class="ui-pagination">
        <!-- 
        @slot Custom before slot
        @binding {Number} page    page
        @binding {Number} pages   pages
        @binding {Function} prev    selects prev page
        @binding {Function} next    selects next page
        -->
        <slot name="before" v-bind="{ page, pages, prev, next }"></slot>
        <!-- 
        @slot Page item slot
        @binding {Number} page    page
        @binding {Number} index   index
        @binding {Function} selectPage   function that selects the page
        -->
        <slot
            v-for="(i, index) in pagesComputed"
            v-bind="{ page: i, index, currentPage: page, selectPage }"
        >
            <div :key="index">
                <div v-if="i == null">...</div>
                <div
                    class="btn btn-small"
                    :class="[i == page ? 'btn-primary' : 'btn-ghost']"
                    @click="selectPage(i)"
                    v-else
                >
                    {{ i.toLocaleString() }}
                </div>
            </div>
        </slot>
        <!-- 
        @slot Custom after slot
        @binding {Number} page    page
        @binding {Number} pages   pages
        @binding {Function} prev    selects prev page
        @binding {Function} next    selects next page
        -->
        <slot name="after" v-bind="{ page, pages, prev, next }"></slot>
    </div>
</template>
<style lang="less" scoped>
.ui-pagination {
    display: flex;
    align-items: center;
}
</style>
<script>
export default {
    props: {
        /**
         * Current page
         */
        page: {
            type: Number,
            default: 1,
        },
        /**
         * Total pages
         */
        pages: {
            type: Number,
            default: 1,
        },
        /**
         * Number of pages to display
         */
        numItems: {
            type: Number,
            default: 7,
        },
    },
    computed: {
        pagesComputed() {
            let arr = [];
            let i = Math.min(
                this.pages + 1 - this.numItems,
                Math.max(1, this.page - ((this.numItems / 2) | 0))
            );
            i = i < 1 ? 1 : i;
            let end = i + this.numItems;
            end = end > this.pages ? this.pages : end;
            while (i < end) {
                arr.push(i++);
            }
            if (arr[0] > 1) {
                if (arr[0] > 2) {
                    arr.unshift(null);
                }
                arr.unshift(1);
            }
            if (arr[arr.length - 1] < this.pages) {
                if (arr[arr.length - 1] < this.pages - 1) {
                    arr.push(null);
                }
                arr.push(this.pages);
            }
            return arr;
        },
        pageFirst() {
            return this.pagesComputed[0];
        },
        pageLast() {
            return this.pagesComputed[this.pagesComputed.length - 1];
        },
    },
    methods: {
        selectPage(page) {
            /**
             * Select page event
             * @property {Number} page
             */
            this.$emit('select', page);
            /**
             * Change page event
             * @property {Number} page
             */
            this.$emit('change', page);
            /**
             * Update page event (for .sync usage)
             * @property {Number} page
             */
            this.$emit('update:page', page);
        },
        prev() {
            if (this.page > 1) {
                this.selectPage(this.page - 1);
            }
        },
        next() {
            if (this.page < this.pages) {
                this.selectPage(this.page + 1);
            }
        },
    },
};
</script>
