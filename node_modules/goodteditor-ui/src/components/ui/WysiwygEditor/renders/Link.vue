<template>
    <ui-tooltip>
        <template #target="{ binds, events, visible }">
            <button
                v-bind="binds"
                v-on="events"
                :title="title"
                :class="{ 'btn-outline': !visible }"
                class="btn btn-small btn-icon btn-primary"
                @click="onClick">
                <div class="icon">
                    <i class="mdi" :class="icon"></i>
                </div>
            </button>
        </template>
        <template #default="{ hide }">
            <div class="w-f2">
                <div class="row row-hgap-3 mar-bot-l1">
                    <div class="col col-vmid text-truncate">
                        <div class="form-label form-label-xsmall text-truncate">Url</div>
                    </div>
                    <div class="col col-vmid col-12-12">
                        <ui-input-autocomplete v-model="url" class="w-100" size="small" />
                    </div>
                </div>
                <div class="row row-hgap-3 mar-bot-l1">
                    <div class="col col-vmid text-truncate">
                        <div class="form-label form-label-xsmall text-truncate">Тип перехода</div>
                    </div>
                    <div class="col col-vmid col-12-12">
                        <ui-select
                            v-model="target"
                            :append-to-body="false"
                            :options="$options.static.TargetTypeOptions"
                            class="w-100"
                            size="small" />
                    </div>
                </div>
                <button class="btn btn-primary btn-small w-100" @click="() => execute(hide)">
                    Применить
                </button>
            </div>
        </template>
    </ui-tooltip>
</template>

<script>
import UiInputAutocomplete from '../../InputAutocomplete.vue';
import UiSelect from '../../Select.vue';
import UiTooltip from './components/Tooltip.vue';
import { useRender, RenderMixinTypes } from './mixins';

const TargetType = {
    BLANK: '_blank',
    SELF: '_self'
};

export default {
    components: {
        UiInputAutocomplete,
        UiTooltip,
        UiSelect
    },
    mixins: [useRender()],
    data: () => ({
        url: '',
        target: null,
    }),
    static: {
        TargetTypeOptions: [
            { label: 'В новой вкладке', value: TargetType.BLANK },
            { label: 'В текущей вкладке', value: TargetType.SELF }
        ]
    },
    methods: {
        ...RenderMixinTypes,
        onClick () {
            const { url = '', target = TargetType.BLANK } = this.tool.getValue();
            this.url = url;
            this.target = target;
        },
        execute(hide) {
            const { tool, url, target } = this;
            tool.exec({ url, target });
            hide();
            this.emitExecuted();
        }
    }
};
</script>
