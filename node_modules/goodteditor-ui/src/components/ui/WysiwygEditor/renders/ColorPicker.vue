<template>
    <div :data-popover="popoverTargetId" :title="title">
        <button
            :class="{ 'btn-outline': !popoverShow }"
            class="btn btn-small btn-icon btn-primary"
            @click="togglePopover">
            <div class="icon">
                <i class="mdi" :class="icon"></i>
            </div>
        </button>
        <popover :show.sync="popoverShow" v-bind="popoverOptions">
            <color-picker class="pull-left" v-bind="{ value, showSubmit: true }" @submit="onSubmit" />
        </popover>
    </div>
</template>

<script>
import ColorPicker from '../../ColorPicker.vue';
import Popover from '../../Popover.vue';
import WithPopover from '../../utils/WithPopover';
import { useRender, RenderMixinTypes } from './mixins';

export default {
    components: { ColorPicker, Popover },
    mixins: [useRender(), WithPopover],
    props: {
        appendToBody: {
            type: Boolean,
            default: false
        }
    },
    computed: {
        value() {
            return this.tool.getValue();
        }
    },
    methods: {
        ...RenderMixinTypes,
        onSubmit({ rgba }) {
            const { r: red, g: green, b: blue, a: alpha } = rgba;
            const color = `rgba(${red}, ${green}, ${blue}, ${alpha})`;

            this.tool.exec(color);
            this.popoverShow = false;
            this.emitExecuted();
        }
    }
};
</script>
