<template>
    <div
        class="ui-popup popup popup-fixed"
        :class="{ fullscreen: fullscreen }"
        @click="onClick"
        v-if="visible"
    >
        <div class="popup-dialog" v-bind="dialog">
            <!--
            @slot Custom close slot
            @binding {Function} close    closes the popup
            -->
            <slot name="close" v-bind="{ close }" v-if="showCloseButton">
                <div class="icon close" @click="close">
                    <i class="mdi mdi-close" style="font-size: 1.25rem"></i>
                </div>
            </slot>
            <div class="popup-dialog-body" :style="dialogBody.style" :class="dialogBodyClass">
                <!--
                @slot Custom body slot
                @binding {Function} close    closes the popup
                -->
                <slot name="body" v-bind="{ close }"></slot>
            </div>
            <div
                class="popup-dialog-footer"
                :class="{ 'pad-none': !usePadding }"
                v-if="$scopedSlots.footer"
            >
                <!--
                @slot Custom footer slot
                @binding {Function} close    closes the popup
                -->
                <slot name="footer" v-bind="{ close }"></slot>
            </div>
        </div>
    </div>
</template>
<style lang="less" scoped>
.ui-popup {
    &.fullscreen {
        .popup-dialog {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            min-height: 100%;
            border-radius: 0;
            overflow: auto;
            &-body {
                flex: 1;
                height: 0;
            }
        }
    }
}
</style>
<script>
export default {
    props: {
        /**
         * Whether the popup is visible (.sync supported)
         */
        visible: {
            type: Boolean,
            default: false,
        },
        /**
         * Whether the popup is modal (clicking outside closes the popup)
         */
        modal: {
            type: Boolean,
            default: false,
        },
        /**
         * Whether the popup is fullscreen
         */
        fullscreen: {
            type: Boolean,
            default: false,
        },
        /**
         * Popup dialog options for styling css/style
         * { class:any style:any }
         */
        dialog: {
            type: Object,
            default() {
                return { class: {}, style: {} };
            },
        },
        /**
         * Popup dialog body options for styling css/style
         * { class:any style:any }
         */
        dialogBody: {
            type: Object,
            default() {
                return { class: {}, style: {} };
            },
        },
        /**
         * Whether to show the close button
         */
        showCloseButton: {
            type: Boolean,
            default: true,
        },
        /**
         * Whether the popup body/footer should have padding
         */
        usePadding: {
            type: Boolean,
            default: true,
        },
        /**
         * Css class which applies on 'body' node when the popup is visible
         */
        visibleBodyClass: {
            type: String,
            default: 'scroll-hide',
        },
    },
    computed: {
        dialogBodyClass() {
            const { dialogBody, usePadding } = this;

            if (usePadding) {
                return dialogBody.class;
            }

            return Array.isArray(dialogBody.class)
                ? [dialogBody.class, 'pad-none']
                : { ...dialogBody.class, 'pad-none': true };
        },
    },
    watch: {
        visible: {
            handler(val) {
                if (!this.visibleBodyClass) {
                    return;
                }
                let m = val ? 'add' : 'remove';
                document.body.classList[m](this.visibleBodyClass);
            },
            immediate: true,
        },
    },
    beforeDestroy() {
        if (this.visibleBodyClass) {
            document.body.classList.remove(this.visibleBodyClass);
        }
    },
    methods: {
        close() {
            /**
             * Close event
             */
            this.$emit('close');
            /**
             * Visibility update event (visible.sync compatibility)
             * @property {Boolean} visible
             */
            this.$emit('update:visible', false);
        },
        onClick(e) {
            if (!this.modal && e.target == this.$el) {
                this.close();
            }
        },
    },
};
</script>
