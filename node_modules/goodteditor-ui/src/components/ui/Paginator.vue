<template>
    <div class="ui-paginator">
        <!-- 
        @slot Page data slot
        @binding {Number} page      current page number 
        @binding {Number} pages     total pages number
        @binding {Array} pageData   current page data
        @binding {(n:number) => {}} setPage     sets a new page
        -->
        <slot v-bind="{ page: currentPage, pages, pageData, setPage }"></slot>
    </div>
</template>
<script>
export default {
    props: {
        /**
         * Data to be paginated
         */
        data: {
            type: Array,
            default() {
                return [];
            },
        },
        /**
         * Current page (.sync supported)
         */
        page: {
            type: Number,
            default: 1,
        },
        /**
         * Number of items displayed per page
         */
        perPage: {
            type: Number,
            default: 10,
            validator(val) {
                return val > 0;
            },
        },
    },
    data() {
        return { currentPage: 1 };
    },
    computed: {
        pages() {
            const { data, perPage } = this;
            return Math.ceil(data.length / perPage);
        },
        pageData() {
            const { data, currentPage, perPage } = this;
            return data ? data.slice((currentPage - 1) * perPage, currentPage * perPage) : [];
        },
    },
    watch: {
        'data.length'() {
            this.setPage(1);
        },
        page: {
            handler(val) {
                this.setPage(val);
            },
            immediate: true,
        },
    },
    methods: {
        setPage(page) {
            this.currentPage = page;
            /**
             * Page change event (page.sync compatibility)
             * @property {number} page
             */
            this.$emit('update:page', page);
            /**
             * Change event
             * @property {number} page
             */
            this.$emit('change', page);
        },
    },
};
</script>
