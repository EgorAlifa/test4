# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã HTTP URL –≤ ElemDotMap

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ HTTP URL –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ–µ–≤ –≤–∏–¥–∂–µ—Ç–∞ ElemDotMap, URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ HTTPS.

## ‚úÖ –†–µ—à–µ–Ω–∏—è (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ)

---

### –í–∞—Ä–∏–∞–Ω—Ç 1: Leaflet Patch (–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–®–∞–≥–∏:**

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –ø–∞—Ç—á –≤ main.js:**

```javascript
import { initLeafletHttpPatch } from './common/leaflet-http-patch';

// –í–ê–ñ–ù–û: –î–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
initLeafletHttpPatch();

// –ó–∞—Ç–µ–º –≤–∞—à –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
new Vue({
  // ...
});
```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTP URL –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å** - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```
   [Leaflet HTTP Patch] –ü–∞—Ç—á —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω
   ```

‚ö†Ô∏è **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è Mixed Content
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å HTTP –∫–æ–Ω—Ç–µ–Ω—Ç

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: UI Input Patch (–ï—Å–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç 1 –Ω–µ –ø–æ–º–æ–≥)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ï—Å–ª–∏ URL –º–µ–Ω—è–µ—Ç—Å—è –≤ —Å–∞–º–æ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞

**–®–∞–≥–∏:**

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –æ–±–∞ –ø–∞—Ç—á–∞ –≤ main.js:**

```javascript
import { initLeafletHttpPatch } from './common/leaflet-http-patch';
import { initAllInputPatches, createHttpUrlMixin } from './common/ui-input-http-patch';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–∞—Ç—á–∏
initLeafletHttpPatch();
initAllInputPatches();

// –ü–æ–¥–∫–ª—é—á–∞–µ–º mixin –≥–ª–æ–±–∞–ª—å–Ω–æ
Vue.mixin(createHttpUrlMixin());

// –ó–∞—Ç–µ–º –≤–∞—à –∫–æ–¥
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å** - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –æ–±–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ç—á–µ–π

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: HTTPS Proxy (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Production)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –î–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### 3A. Node.js Proxy (–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫)

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã:**
   ```bash
   cp src/common/http-proxy-server.js ./
   cp src/common/proxy-server-package.json ./package.json
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   npm install
   ```

3. **–°–æ–∑–¥–∞–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:**
   ```bash
   npm run generate-cert
   ```

   –ò–ª–∏ –¥–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—Å—Ç–æ—è—â–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Let's Encrypt

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   export TARGET_SERVER=http://your-http-tile-server.com
   export HTTPS_PORT=8443
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–∫—Å–∏:**
   ```bash
   npm start
   ```

6. **–í ElemDotMap –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**
   ```
   https://localhost:8443/{z}/{x}/{y}.png
   ```

#### 3B. Nginx Proxy (Production-ready)

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   sudo cp src/common/nginx-http-proxy.conf /etc/nginx/sites-available/tiles-proxy
   ```

2. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   sudo nano /etc/nginx/sites-available/tiles-proxy
   ```
   - –ó–∞–º–µ–Ω–∏—Ç–µ `tiles-proxy.yourdomain.com` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
   - –ó–∞–º–µ–Ω–∏—Ç–µ `http://your-http-tile-server.com` –Ω–∞ –∞–¥—Ä–µ—Å HTTP tile —Å–µ—Ä–≤–µ—Ä–∞
   - –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç–∏ –∫ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º

3. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   sudo ln -s /etc/nginx/sites-available/tiles-proxy /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl reload nginx
   ```

4. **–í ElemDotMap –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**
   ```
   https://tiles-proxy.yourdomain.com/{z}/{x}/{y}.png
   ```

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### Leaflet Patch:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
// [Leaflet HTTP Patch] –ü–∞—Ç—á —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω
// [Leaflet HTTP Patch] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTP URL –¥–ª—è tile layer: http://...
```

### UI Input Patch:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
// [UI Input HTTP Patch] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ç—á–∞ –¥–ª—è ui-input
// [UI Input HTTP Patch] DOM –ø–∞—Ç—á –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
```

### Proxy Server:
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
https://localhost:8443/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
{
  "status": "ok",
  "target": "http://...",
  "timestamp": "..."
}
```

---

## üîß Troubleshooting

### –ü–∞—Ç—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úì –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ç—á –ø–æ–¥–∫–ª—é—á–µ–Ω –î–û –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–∂–µ—Ç–∞
- ‚úì –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ç—á–∞
- ‚úì –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)

### –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç HTTP
- ‚ûú –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS Proxy (–í–∞—Ä–∏–∞–Ω—Ç 3)
- ‚ûú –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CSP
- ‚ûú –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –∑–∞–ø—É—Å—Ç–∏—Ç–µ Chrome —Å —Ñ–ª–∞–≥–æ–º `--allow-running-insecure-content`

### –ü—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úì –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–∫—Å–∏ –∑–∞–ø—É—â–µ–Ω: `curl -k https://localhost:8443/health`
- ‚úì –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- ‚úì –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ü–µ–ª–µ–≤–æ–≥–æ HTTP —Å–µ—Ä–≤–µ—Ä–∞

### URL –≤—Å–µ –µ—â–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ HTTPS
1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (UI Input Patch)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. –û—Ç–∫—Ä–æ–π—Ç–µ issue —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ–±–ª–µ–º—ã

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/common/LEAFLET_HTTP_PATCH_README.md`
- **–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø–∞—Ç—á–µ–π:** `src/common/leaflet-http-patch.js`, `src/common/ui-input-http-patch.js`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx:** `src/common/nginx-http-proxy.conf`
- **Node.js –ø—Ä–æ–∫—Å–∏:** `src/common/http-proxy-server.js`

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

| –û–∫—Ä—É–∂–µ–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|-----------|----------------------|---------|
| Development | –í–∞—Ä–∏–∞–Ω—Ç 1 (Leaflet Patch) | –ë—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ |
| Staging | –í–∞—Ä–∏–∞–Ω—Ç 3 (Node.js Proxy) | –ë–ª–∏–∑–∫–æ –∫ production |
| Production | –í–∞—Ä–∏–∞–Ω—Ç 3 (Nginx Proxy) | –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ |

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°–æ–∑–¥–∞—Ç—å self-signed —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
openssl req -x509 -newkey rsa:2048 -nodes \
  -keyout key.pem -out cert.pem -days 365 \
  -subj "/CN=localhost"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Node.js proxy
TARGET_SERVER=http://tiles.example.com npm start

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Nginx
sudo systemctl reload nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–æ–∫—Å–∏
curl -k https://localhost:8443/health
```
