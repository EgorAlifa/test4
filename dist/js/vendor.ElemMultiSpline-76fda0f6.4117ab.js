export const __webpack_id__=2785;export const __webpack_ids__=[2785];export const __webpack_modules__={43572:(t,e,o)=>{o.r(e),o.d(e,{default:()=>W});var s=function(){var t=this,e=t._self._c;return e("w-elem",{attrs:{placeholder:t.$placeholder}},[e("w-tooltip",t._b({staticClass:"w-100 h-100",attrs:{"is-shown":t.customTooltip.isShown},on:{"update:isShown":function(e){return t.$set(t.customTooltip,"isShown",e)},"update:is-shown":function(e){return t.$set(t.customTooltip,"isShown",e)}},scopedSlots:t._u([{key:"target",fn:function(){return[e("div",{ref:"chartAwesome",staticClass:"w-100 h-100"},[t.hasError?e("div",{staticClass:"message message--error"},[t._v(" "+t._s(t.error)+" "),e("i",{staticClass:"message__icon message__icon--close",on:{click:t.closeErrorWindow}})]):t._e()])]},proxy:!0},{key:"tooltip",fn:function(){return[t.props.customTooltip.isSlotShown?e("div",{attrs:{"data-slot":"tooltip"},on:{mouseenter:function(e){t.customTooltip.options.isShown=!0}}},[t._t("tooltip",function(){return[e("div",{staticClass:"muted"},[e("code",{staticClass:"text-small"},[t._v("Tooltip slot")])])]})],2):t._e()]},proxy:!0}],null,!0)},"w-tooltip",t.customTooltip.options,!1)),t.isLoading?e("div",{staticClass:"curtain"},[e("div",{staticClass:"curtain__preloader"})]):t._e(),t.props.dremio?t._e():e("div",{staticClass:"message message--warn"},[t._v("no dataset selected")]),t.isBreadcrumbsShown?e("div",{staticClass:"breadcrumb"},[t._v(t._s(t.breadcrumbText))]):t._e()],1)},i=[],a=o(93423),r=o(5021),n=o(60997),l=o(14120),d=o(7609),c=o.n(d),u=o(46996),h=o(91105),m=o(20903),p=o(37364),S=o(39849),f=o(33612),y=o(91076),C=o(26961),b=o(77546);const w=()=>({props:{dremio:{type:Array,default:()=>[]},additionalDremio:{type:Object,default:null},width:{type:String,default:""},widthUnit:{type:String,default:""},height:{type:String,default:"100"},heightUnit:{type:String,default:"%"},position:{type:String,default:"pos-rel"},metricsStyle:{type:Array,default:()=>[]},selectEvent:{type:Object,default:()=>({})},barGap:{type:String,default:()=>"",label:"Отступ"},tooltip:{type:Object,default:()=>(0,m.A)(S.S1)},metricNames:{type:Array,default:()=>[]},dimensionOptions:{type:Object,default:()=>(0,m.A)(S.FP)},backgroundColor:{type:Object,default:()=>(0,m.A)(S.i0)},mainTitle:{type:Object,default:()=>(0,m.A)(S.OB)},axis:{type:Array,default:()=>S._s},legend:{type:Object,default:()=>(0,m.A)(S.s$)},axisPointer:{type:Object,default:()=>(0,S.PL)()},topOptions:{type:Object,default:()=>(0,m.A)(S.kV)},toolbox:{type:Object,default:()=>(0,m.A)(S.KT)},dataZoom:{type:Object,default:()=>(0,m.A)(S.eW)},dataZoomInside:{type:Object,default:()=>(0,m.A)(S.sr)},grid:{type:Object,default:()=>(0,S.fW)()},legendManualSize:{type:Object,default:()=>(0,S.dm)()},breadcrumb:{type:Object,default:()=>(0,S.QC)()},customTooltip:{type:Object,default:n.TooltipDefaultFactory},multiLevelDimension:{type:Object,default:()=>({isUsed:!1,shouldResetFirstLevel:!1})},shouldSkipLevelWithOneValue:{type:Boolean,default:!0},shouldSkipLevelWithIdenticalValue:{type:Boolean,default:!1},shouldResetVar:{type:Boolean,default:!0},neutralMetrics:{type:Object,default:()=>({isEnabled:!1,color:"rgba(230, 230, 230, 1)",symbolColor:"rgba(230, 230, 230, 1)",symbolBdrColor:"rgba(230, 230, 230, 1)"})}},vars:{},dataset:{vars:{dimension:{operation:a.StoreOperation.ALL}}}}),x=(0,r.useDatasetMeta)({descriptor:w,isChildAllowed:!0,slotNames:["tooltip"],cssVars:C.O,panels:b.A},{panel:{isMultiple:!0,mixins:[b.a]},deviations:!0});var v=o(43620);const g=(0,r.useElemDatasetBaseMixin)({drilldown:!0,panel:!1,deviations:!0}),T={extends:a.Elem,components:{WTooltip:n.Tooltip},mixins:[g,f.M],meta:x,hooks:{then(t){const e=this.resolveComposedResults(t);this.results=e,this.handleSkipDrilldownLevel(e)||this.constructOpts()}},data(){return{isLoading:!1,chartInstance:null,lastCommit:null,results:[],scaleValue:0,isFirstRun:!0,privateProps:null,chosenDimValue:null,mainDimValues:[],chosenNeutralMetricIndexes:[],hasTopMode:!0,error:null,drilldownLastDirection:1,customTooltip:{options:{appendToBody:!1,data:null,coordinates:[0,0],isFixed:!1},isShown:!1},...r.ElemDatasetBaseMixinTypes}},computed:{hasError(){return this.hasDataset&&null!=this.error},drilldownState(){const{main:{name:t}}=this.props.dimensionOptions;return{...this.$drilldown.state[t],name:t}},drilldownCanPop(){return this.drilldownState?.canPop??!1},drilldownCanPush(){return this.drilldownState?.canPush??!1},isBreadcrumbsShown(){const{props:{breadcrumb:{isShown:t}},breadcrumbText:e}=this;return t&&""!==e},grid(){const{grid:t,legend:e}=this.props,{dataZoom:o}=this;return t?.isManualMode?t:{top:e.show&&null!==e.top?"36":"24",right:"15",bottom:e.show&&null!==e.bottom||o?.show?"25":"15",left:"15",containLabel:!0}},options(){const{legend:{textStyle:{fontSize:t,...e},...o},mainTitle:{textStyle:{fontSize:s,...i},...a},backgroundColor:r,legendManualSize:n}=this.props,{dataZoom:l,tooltip:d,toolbox:c,axisPointer:u,grid:h,datasetRequests:m}=this;return{group:"group",series:[],toolbox:c,grid:h,title:{...a,text:""===a.text?m[0]?.name??a.text:a.text,textStyle:{...i,fontSize:this.takeUnit2Px({size:s})}},legend:{...o,textStyle:{...e,fontSize:this.takeUnit2Px({size:t})},...n.isManualMode&&n},backgroundColor:r,xAxis:[],yAxis:[],dataZoom:l,axisPointer:u,tooltip:d,animation:!0}},toolbox(){const{show:t,itemSize:e,iconStyle:o,prevTitle:s}=this.props.toolbox,{enable:i,btn:a}=this.props.topOptions;return{show:t,itemSize:e,iconStyle:{color:o.color,borderWidth:.5},feature:{myPrevBtn:{show:this.drilldownCanPop,name:"prev",title:s||S.KT.prevTitle,icon:"path://M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z",onclick:this.onPrevBtnClick},myTopBtn:{show:i&&a.show,name:"top",title:a.title,icon:`path://${this.hasTopMode?a.defaultIconPath:a.topIconPath}`,onclick:this.onTopBtnClick}}}},tooltip(){const{tooltip:t,metricsStyle:e}=this.props;return{...t,formatter:o=>y.Wp.tooltipFormatter.bind(t)(e,o)}},dataZoom(){const{dataZoom:t,dataZoomInside:e}=this.props,{startPercentValue:o,endPercentValue:s,isPercent:i,show:a,handleIcon:r,endValue:n}=t,l=!a,d=i?{start:o,end:s}:{};return l?null:[{...t,moveHandleSize:0,...d,textStyle:{...t.textStyle,fontSize:this.takeUnit2Px({size:t.textStyle.fontSize})},handleIcon:`path://${r}`,endValue:n-1},{...t,...d,handleIcon:`path://${r}`,endValue:n-1,...e}]},axisPointer(){const{axisPointer:t}=this.props;return t?.show?{...t,triggerOn:"none",value:this.scaleValue}:null},computedStyle(){return null!=this.$el?getComputedStyle(this.$el):{}},breadcrumbText(){const{breadcrumb:{isShown:t,delimiter:e}}=this.props;return t?[...new Set(this.drilldownState.filters?.map(({value:t})=>t))??""].join(e??(0,S.QC)().delimiter):""}},watchEditor:{props:{handler(t){this.privateProps=(0,y.$2)(t)},deep:!0},[["cssStyle","cssClass",S.y.map(t=>`props.${t}`)]]:{handler(t,e){if(t&&!(0,u.A)(t,e)){const t=this.resolveComposedResults();this.results=t,this.$nextTick().then(this.constructOpts)}},deep:!0}},created(){this.privateProps=(0,y.$2)(this.props),this.addUnit2PxWatcher(this.constructOpts)},mounted(){this.initResize()},beforeDestroy(){window.removeEventListener("resize",this.throttledResize),this.destroyChart()},methods:{resolveComposedResults(t=this.results){return t.map(t=>({...t,rows:t.rows.map((t,e)=>({...t,...this.deviations.rows[e]}))}))},closeErrorWindow(){this.error=null},initResize(){this.throttledResize=(0,h.A)(this.onResize,S.il),window.addEventListener("resize",this.throttledResize)},drilldownPop(){const{name:t,canPop:e}=this.drilldownState;!1!==e&&(this.$drilldown.pop(t),this.drilldownLastDirection=this.drilldownState.canPop?-1:1)},drilldownPush(t){const{name:e,canPush:o}=this.drilldownState;!1!==o?(this.$drilldown.push(e,t),this.drilldownLastDirection=this.drilldownState.canPush?1:0):this.drilldownLastDirection=1},onResize(){this.chartInstance&&this.chartInstance.resize()},async loadData(t=this.requests){this.$requestCancel(t),this.isLoading=!0;try{let e=await Promise.all(t.map(t=>t?.send()));e=e.map((t,e)=>t??this.results[e]??null),this.results=e,this.$options.hooks.then.call(this,this.results)}catch(e){this.results=[],this.$handleError(e)}finally{this.isLoading=!1}},buildSeriesData(t,e,o){const{props:{dimensionOptions:{main:{name:s}}}}=this,i=y.Wp.findCategoryAxis(e,o),a="xAxis"===i?e.xAxisIndex:e.yAxisIndex,r=o[i][a],{data:n,valueFontSize:l,axisLabel:d}=r,{seriesData:c,axisData:u}=this.aggregateData(e,t);u.forEach(e=>{const{name:o}=e;if(!n.some(({name:t})=>t===o)){const{type:i,imageMetric:a,imageHeight:c,rich:u}=d;if("value"!==i&&""!==a){const e=t.find(t=>t[s]===o),i=e[a],r=y.Wp.memoTransliterate(o).replace(/\s/g,"_");u[r]={backgroundColor:{image:i},height:c}}e.textStyle.fontSize=l,e.textStyle.fontWeight=this.chosenDimValue===o&&r.shouldHighlightSelectedLabels?"bold":"normal",n.push(e)}});let h=this.formSeriesTop(e,c,r);return e.isCumulativeTotal&&(h=y.Wp.getCumulativeTotalData(h)),e.isCumulativeDifference&&(h=y.Wp.getCumulativeDifference(h)),h=y.Wp.resolveStyleDataItems(e,h),h},resolveMetricName(t){const{metricName:e,multiMetricMode:o}=t;return o.enable?o.metricNames[this.drilldownState.index]??e:e},aggregateData(t,e){const{props:{dimensionOptions:{main:{name:o},minor:{name:s}},axis:i}}=this,a=this.resolveMetricName(t),r=i.find(({type:t})=>"category"===t),{isShownNullLabels:n=!1}=r??{};return e.reduce(({seriesData:e,axisData:i},r)=>{const l=r[o]||r[this.props.topOptions.rest.title];if(null==l)return{seriesData:e,axisData:i};const d=r[a],{customType:c,name:u,label:h}=t,m=[null,void 0,""].includes(d)?null:Number(d),{isAddlLabelShown:p,rich:S={}}=h,f=p?r[S.additional?.metric]??null:null;if(!1===c.includes("stacked"))return y.Wp.addAgrData(e,l,m,i,f,t,n),{seriesData:e,axisData:i};const C=s?r[s]:null;return C===u?(y.Wp.addAgrData(e,l,m,i,f,t,n),{seriesData:e,axisData:i}):{seriesData:e,axisData:i}},{seriesData:[],axisData:[]})},formSeriesTop(t,e,o){const{enable:s,type:i,rest:a,metrics:r,number:n,dir:l}=this.props.topOptions;if(!["bar","line"].includes(t.customType)||i===v.IF.METRIC)return e;if(s&&this.hasTopMode){if(e.length-1<=n)return e;if(a.show&&!o.data.some(t=>t.name===a.title)){const{title:t}=a;o.data.push({name:t,value:t,textStyle:{fontSize:o.valueFontSize,fontWeight:this.chosenDimValue===t?"bold":"normal"}})}if(r.includes("all")||r.includes(t.name)){const t=y.Wp.getTop(e,{number:n,dir:l});let o=0;const s=e.map((e,s)=>t.some(t=>t.index===s)?e:(o+=e.value,{...e,value:null}));if(a.show){if(a.reduce.enable){const e=Math.max(...t.map(({value:t})=>t)),s=e+e/100*a.reduce.percent;o=o>s?s:o}s.push({name:a.title,value:o,itemStyle:{color:null}})}return s}if(a.show)return e.push({name:a.title,value:null}),e}return e},storeCommitNulls(){const t=[...this.metrics,...this.dimensions].reduce((t,e)=>({...t,[e]:null}),{});this.$storeCommit(t)},storeCommitNullsAtFirstLevel(){const{isUsed:t,shouldResetFirstLevel:e}=this.props.multiLevelDimension;t&&e&&!1===this.drilldownCanPop&&this.$storeCommit({[this.drilldownState.name]:null})},storeCommitState({value:t,seriesName:e}){const{shouldResetVar:o,dimensionOptions:{main:{name:s},minor:{name:i=""}}}=this.props,a=this.results.flatMap(({rows:t})=>t).find(o=>o[s]===t&&(""===i||o[i]===e));if(!0===o)return this.lastCommit=null==a?Object.entries(this.lastCommit).reduce((t,[e])=>({...t,[e]:null}),{}):a,void this.$storeCommit(this.lastCommit);this.lastCommit=a,null!=a&&this.$storeCommit(a)},onClickHandler({componentType:t,targetType:e,seriesIndex:o,seriesName:s,name:i,value:a},r){this.toggleNeutralSeriesColorsByClick({series:r,seriesIndex:o});const n=t=>{this.drilldownCanPush?(this.storeCommitState({value:t,seriesName:s}),this.drilldownPush(t)):(this.chosenDimValue=this.chosenDimValue===t?null:t,this.storeCommitState({value:this.chosenDimValue,seriesName:s}),this.constructOpts())};"axisLabel"===e&&n(a),"series"===t&&n(i)},onPrevBtnClick(){!1===this.drilldownCanPush&&this.storeCommitNulls(),this.drilldownPop(),!1===this.drilldownCanPop?this.storeCommitNullsAtFirstLevel():this.storeCommitNulls(),this.chosenDimValue=null},onTopBtnClick(){this.hasTopMode=!this.hasTopMode,this.constructOpts()},composeCustomColors(t){if(null==t?.gradient||!1===t?.gradient)return t?.fillColor?{areaStyle:{color:(0,l.convertCssVarToComputedValue)(t.fillColor,this.computedStyle)}}:{};const[e,o,s,i]=t?.colorPos?.split(" ");return{areaStyle:{color:{type:"linear",x:e,y:o,x2:s,y2:i,colorStops:""!==t?.firstColor&&""!==t?.secondColor?[{offset:t.offSetFirstColor,color:(0,l.convertCssVarToComputedValue)(t.firstColor,this.computedStyle)},{offset:t.offSetSecondColor,color:(0,l.convertCssVarToComputedValue)(t.secondColor,this.computedStyle)}]:[]}}}},createStackedSeries(t,e,o){const{main:s,minor:i}=this.props.dimensionOptions,a=y.Wp.getDimValues(e,i.name),{customType:r,stackLines:n,customColors:d,color:c,colorStep:u}=t,h=r.includes("line"),f=h&&!1===n?"":S.u6;return a.reduce((e,o,i)=>{if(!1===a.includes(o))return e;const r=(0,m.A)(t),{customFillLine:n,fillSymbol:S,itemStyle:{color:C}}=r,b=d.find(({name:t})=>t===o),w=(0,l.convertCssVarToComputedValue)(b?.color,this.computedStyle)??y.Wp.createColor((0,l.convertCssVarToComputedValue)(c,this.computedStyle),u,i),x=(0,p.A)(r,{name:o,type:h?"line":"bar",customType:h?"stacked line":"stacked",stack:f,dimensions:s.name,itemStyle:{color:h&&S?C:w},lineStyle:{color:h?w:null},tooltip:{formatter:y.Wp.tooltipSeriesFormatter.bind(r)},label:{formatter:y.Wp.labelFormatter.bind(r)},animationEasingUpdate:r.animationEasing,animationDurationUpdate:r.animationDuration,animationDelayUpdate:r.animationDelay,...b&&n?this.composeCustomColors(b):{}}),{shadowColor:v,shadowBlur:g,shadowOffsetX:T,shadowOffsetY:D,...O}=x.itemStyle;return[...e,{...x,..."stacked line"===t.customType?{itemStyle:O,lineStyle:{...x.lineStyle,shadowBlur:g,shadowOffsetX:T,shadowOffsetY:D,shadowColor:x.shouldSyncShadowColor?x.itemStyle.color:v}}:{itemStyle:{...O,shadowBlur:g,shadowOffsetX:T,shadowOffsetY:D,shadowColor:x.shouldSyncShadowColor?x.itemStyle.color:v}}}]},[]).map(t=>({...t,data:this.buildSeriesData(e,t,o)}))},composeSeriesOption(t){const{shadowColor:e,shadowBlur:o,shadowOffsetX:s,shadowOffsetY:i,borderColor:a,...r}=t.itemStyle;return{...t,...t.fillLine&&t.shouldSyncColor?{areaStyle:{color:(0,l.convertCssVarToComputedValue)(t.color,this.computedStyle)}}:{},tooltip:{...t.tooltip,formatter:y.Wp.tooltipSeriesFormatter.bind(t)},label:{...t.label,formatter:y.Wp.labelFormatter.bind(t)},animationEasingUpdate:t.animationEasing,animationDurationUpdate:t.animationDuration,animationDelayUpdate:t.animationDelay,..."line"===t.customType?{itemStyle:{...r,...(()=>{const e=t.shouldDotsSyncColor?(0,l.convertCssVarToComputedValue)(t.color,this.computedStyle):a;return{borderColor:e,color:t.shouldDotsSyncColor?e:t.symbolColor}})()},lineStyle:{...t.lineStyle,shadowBlur:o,shadowOffsetX:s,shadowOffsetY:i,color:t.color,shadowColor:t.shouldSyncShadowColor?t.color:e}}:{itemStyle:{...r,borderColor:a,shadowBlur:o,shadowOffsetX:s,shadowOffsetY:i,color:t.color,shadowColor:t.shouldSyncShadowColor?t.color:e}}}},buildClassicSeries(t,e,o,s){const{main:{name:i}}=this.props.dimensionOptions,{topOptions:a}=this.props,{metrics:r}=this;return t.reduce((t,a)=>{const n="plan"!==a.customType&&"fact"!==a.customType&&!a.customType.includes("stacked"),l=a.multiMetricMode?.metricDatasets?.[this.drilldownState.index]||a.originIdx,d=a.multiMetricMode.enable?Number(l)===s:s===Number(a.originIdx);if(a.showDataSet&&n&&d){if(!1===a.isTopSeries&&!1===r.includes(a.metricName))return t;const{shadowColor:s,shadowBlur:n,shadowOffsetX:l,shadowOffsetY:d,borderColor:c,...u}=a.itemStyle;t.push({...this.composeSeriesOption(a),dimensions:i,data:this.buildSeriesData(e,a,o)})}return t},[])},buildComparedSeries(t,e,o,s){let i=[];const a=t.find(({customType:t,metricName:e,originIdx:o})=>"fact"===t&&""!==e&&Number(o)===s),r=t.find(({customType:t,metricName:e,originIdx:o})=>"plan"===t&&""!==e&&Number(o)===s);if(!a||!r)return i;const{main:n}=this.props.dimensionOptions;a.dimensions=n.name,a.stack=S.u6,a.itemStyle.color=a.color,a.itemStyle.shadowColor=a.shouldSyncShadowColor?a.color:a.itemStyle.shadowColor;const l=this.buildSeriesData(e,a,o);r.dimensions=n.name,r.stack=S.u6,r.itemStyle.color=r.color,r.itemStyle.shadowColor=r.shouldSyncShadowColor?r.color:r.itemStyle.shadowColor;const d=this.buildSeriesData(e,r,o),c={originIdx:r.originIdx,barWidth:r.barWidth,barMinWidth:r.barMinWidth,barMaxWidth:r.barMaxWidth,dimensions:n.name,metricSeparator:r.metricSeparator,metricFormat:r.metricFormat,metricPrefix:r.metricPrefix,metricPostfix:r.metricPostfix,smooth:r.smooth,label:r.excessLackLabel,animationEasing:r.animationEasing,animationEasingUpdate:r.animationEasing,animationDuration:r.animationDuration,animationDurationUpdate:r.animationDuration,animationDelay:r.animationDelay,animationDelayUpdate:r.animationDelay},u={name:r.nameExcess,color:r.excess.color,itemStyle:{shadowColor:r.shouldSyncShadowColor?r.excess.color:r.itemStyle.shadowColor}},h={name:r.nameLack,color:r.lack.color,itemStyle:{shadowColor:r.shouldSyncShadowColor?r.lack.color:r.itemStyle.shadowColor}},f=(0,p.A)((0,m.A)(S.tz),c,u),C=(0,p.A)((0,m.A)(S.tz),c,h),b=y.Wp.findCategoryAxis(r,o);d.forEach(t=>{let e=l.find(e=>e.name===t.name),o=t.value-e.value;const s=e.value-t.value,i=[0,0,0,0],n=500,d="xAxis"===b?[n,n,0,0]:[0,n,n,0],c=(t,e,o=null)=>({name:t,value:e,itemStyle:{barBorderRadius:o}});if(s>0){a.data.push(c(t.name,null)),r.data.push(c(t.name,t.value,i)),C.data.push(c(t.name,null));const e=f.smooth?d:i;f.data.push(c(t.name,s,e))}else{e=0!==Number(e.value)?e.value:null,a.data.push(c(t.name,e,i)),r.data.push(c(t.name,null)),f.data.push(c(t.name,null)),o=0!==Number(o)?o:null;const s=C.smooth?d:i;C.data.push(c(t.name,o,s))}});const w=[a,r,f,C];return w.forEach(t=>{t.tooltip.formatter=y.Wp.tooltipSeriesFormatter.bind(t),t.label.formatter=y.Wp.labelFormatter.bind(t)}),i=w,i},buildStackedSeries(t,e,o,s){const{dimensionOptions:i}=this.props,{name:a,sort:r,format:n}=i.minor;if(""===a)return[];const l=t.reduce((t,i)=>{const{showDataSet:a,metricName:l,customType:d,originIdx:c}=i;if(a&&""!==l&&d.includes("stacked")&&Number(c)===s){const s=this.createStackedSeries(i,e,o);return y.Wp.sortArray(s,r,n),t.concat(s)}return t},[]);return y.Wp.smoothStackedSeries(l,o)},handleSkipDrilldownLevel(t){const{name:e,filters:o,canPop:s,canPush:i}=this.drilldownState;if(null===e)return!1;const{rowCount:a,rows:r}=t[0],{props:{shouldSkipLevelWithOneValue:n,shouldSkipLevelWithIdenticalValue:l}}=this;if(0===a&&s)return this.storeCommitNulls(),this.drilldownPop(),this.storeCommitNullsAtFirstLevel(),!0;const d=1===r.length&&(n||l&&o.slice(-1)[0]?.value===r[0][e]);if(!1===d)return!1;if(-1===this.drilldownLastDirection&&s)return this.drilldownPop(),!0;if(1===this.drilldownLastDirection&&i){const[t]=r,o=t[e];return this.drilldownPush(o),!0}return!1},getSeries(t,e){const{results:o,props:{topOptions:s,dimensionOptions:{main:i}}}=this,{multiMetricMode:a}=t?.[0]??{},{enable:r}=a??{},{name:n,sort:l,format:d}=i,c=a?.metricSorts?.[this.drilldownState.index]||l;let u=[];this.mainDimValues=o.reduce((t,{rows:e})=>{const o=y.Wp.getDimValues(e,n).filter(e=>!t.includes(e));return[...t,...o]},[]).sort(y.Wp.sortDimValues.bind(i));const{classicSeries:h,comparedSeries:m,stackedSeries:p}=o.reduce((o,{rows:s,rowCount:i},a)=>(o.classicSeries.push(...this.buildClassicSeries(t,s,e,a)),o.comparedSeries.push(...this.buildComparedSeries(t,s,e,a)),o.stackedSeries.push(...this.buildStackedSeries(t,s,e,a)),o),{classicSeries:[],comparedSeries:[],stackedSeries:[]});return y.Wp.removeUselessDimVals(h,e),u=u.concat(h,m,p),y.Wp.postprocessSeriesData(u,e,r?c:l,d),u=this.adaptSeriesWithTop(u),u=this.adaptSeriesWithNeutral(u),u},adaptSeriesWithNeutral(t){const{isEnabled:e,color:o,symbolColor:s,symbolBdrColor:i}=this.props.neutralMetrics;if(!1===e)return t;const a=t.map((t,e)=>{const{color:a,borderColor:r}=t.itemStyle,{color:n=null}=t?.lineStyle??{},l={itemStyle:{color:a,borderColor:r},lineStyle:{color:n}},d={itemStyle:{...t?.emphasis?.itemStyle,color:a,borderColor:r},lineStyle:{...t?.emphasis?.lineStyle,color:n}};return this.chosenNeutralMetricIndexes.includes(e)?{...t,initialColors:l,emphasis:d}:{...t,initialColors:l,emphasis:d,itemStyle:{...t.itemStyle,color:s,borderColor:i},lineStyle:{...t?.lineStyle??{},color:o}}});return a},toggleNeutralSeriesColorsByClick({series:t,seriesIndex:e}){const{isEnabled:o}=this.props.neutralMetrics;if(!1===o)return;let s=[...this.chosenNeutralMetricIndexes];s.includes(e)?s=s.filter(t=>t!==e):s.push(e),this.chosenNeutralMetricIndexes=s},toggleNeutralSeriesColors({series:t,seriesIndex:e}){const o=t.map((t,o)=>{const{initialColors:{itemStyle:s,lineStyle:i}}=t??{};return o===e?{...t,itemStyle:{...t.itemStyle,...s},lineStyle:{...t?.lineStyle??{},...i}}:t});return o},adaptSeriesWithTop(t){const{enable:e,type:o,rest:s,number:i,dir:a,metricsStyle:r}=this.props.topOptions;if(!1===e||!1===this.hasTopMode||o===v.IF.DIMENSION)return t;const n=t.map((t,e)=>({value:t.data.reduce((t,e)=>null!=e.value?t+e.value:t,0),index:e})),l=y.Wp.getTopMetric(n,{number:i,dir:a}),d=l.map(({index:t})=>t),{topMetrics:c,restMetrics:u}=t.reduce((t,e,o)=>(t[!0===d.includes(o)?"topMetrics":"restMetrics"].push(e),t),{topMetrics:[],restMetrics:[]});return!0===s.show&&c.push(this.convertSeriesFields2Px(this.composeSeriesOption(this.buildSeriesOptions([{...r,name:s.title,metricName:s.title,marker:s.title,data:Array.from({length:Math.max(...u.map(({data:t})=>t?.length??0))},(t,e)=>({value:u.reduce((t,{data:o})=>t+(o[e]?.value??0),0)})),...r.fillLine&&!1===r.shouldSyncColor&&!1===r.gradient&&{areaStyle:{...r.areaStyle??{},color:r.fillColor}},isTopSeries:!0}])[0]))),c},buildSeriesOptions(t){return t.map(({label:{rich:t,align:e,fontSize:o,...s},...i})=>{const a=this.convertSeriesFields2Px(i),r={...s,fontSize:this.takeUnit2Px({size:o}),align:(t=>{const e=t.toLowerCase(),o=e.includes("left"),s=e.includes("right"),i=e.includes("inside");return o?i?"left":"right":s?i?"right":"left":"center"})(s.position)};return"center"!==e&&("left"===e&&(r.offset=[-15,0]),"right"===e&&(r.offset=[15,0])),{...a,label:{...r,rich:{...t,...null!=t?.additional?{additional:{...t.additional,fontSize:this.takeUnit2Px({size:t.additional.fontSize})}}:{},...null!=t?.prefix?{prefix:{...t.prefix,fontSize:this.takeUnit2Px({size:t.prefix.fontSize})}}:{},...null!=t?.postfix?{postfix:{...t.postfix,fontSize:this.takeUnit2Px({size:t.postfix.fontSize})}}:{},base:{...r,align:e}}}}})},constructOpts(){const{results:t,privateProps:{metricsStyle:e,axis:o},props:{tooltip:s,axisPointer:i,dimensionOptions:{main:{name:a,format:r}},dataZoom:{isUsedBaseMinMaxValue:n,show:l}}}=this;if(!(t&&t.length>0&&a))return;const d=o.find(({type:t})=>"category"===t),c=this.buildSeriesOptions(e),{xAxis:u,yAxis:h}=y.Wp.getAxis({axisOptions:o.map(({valueFontSize:t,additionalAxisLabel:e,...o})=>({...o,valueFontSize:this.takeUnit2Px({size:t}),...null!=e?{additionalAxisLabel:{...e,fontSize:this.takeUnit2Px({size:e.fontSize})}}:{}})),tooltip:s,axisPointer:i,dimFormat:r,dimName:a,rows:t[d?.additionalAxisLabel?.datasetIndex??0].rows}),m=this.getSeries(c,{xAxis:u,yAxis:h}).map(t=>{const{labelLayout:e={},data:o}=t;return["x","y"].forEach(t=>{0===e[t]&&delete e[t]}),!0!==e.use&&(t.labelLayout={}),null!=t.tooltip&&(0,y.aW)(t),{...t,data:o.map(({value:t,...e})=>({...e,value:0===t?S.qO:t}))}});if(!1===n&&l){const{min:t,max:e}=y.Wp.calcSeriesMinMax(m);[h,u].flat().forEach(o=>{"value"===o.type&&(o.min=o.min({min:t}),o.max=o.max({max:e}))})}const{dataZoom:p}=this,f=[h,u].flat().find(({type:t})=>"category"===t),C=f?.data?.length??0,b={...this.options,dataZoom:null!=p&&!0===p.map(({inverseDirection:t=!1})=>t).find(t=>t)?p.map(({startValue:t,endValue:e,...o})=>({startValue:C-e,endValue:C-t,...o})):p,series:m,xAxis:u,yAxis:h},{barGap:w}=this.props;isNaN(parseInt(w))||(b.barGap=w),null!=b.legend&&(b.legend.itemStyle??={borderWidth:0}),null!=b.tooltip&&(0,y.aW)(b),this.drawChart(b),this.addEventListeners(m)},destroyChart(){this.chartInstance&&this.chartInstance.dispose&&(this.chartInstance.dispose(),this.chartInstance=null)},initChart(){const t=this.$refs.chartAwesome;this.chartInstance=c().init(t)},drawChart(t){this.destroyChart(),this.initChart(),this.isFirstRun&&(this.isFirstRun=!1,this.resizeByTimeout(S.il)),this.chartInstance.setOption((0,l.convertCssVarToComputedValue)(t,this.computedStyle)),this.resizeByTimeout(S.l1)},resizeByTimeout(t){setTimeout(()=>{this.chartInstance.resize()},t)},addEventListeners(t){const{isEnabled:e,shouldFollowPointer:o}=this.props.customTooltip;if(this.chartInstance.on("click","series",e=>this.onClickHandler(e,t)),this.chartInstance.on("mouseover","series",e=>this.onMouseOver(e,t)),this.chartInstance.on("mouseout","series",e=>this.onMouseOut(e,t)),!1===e||!1===o)return;const s=(0,h.A)(this.onMouseMove,S.l1);this.chartInstance.on("mousemove","series",s)},onMouseMove({event:{event:t}}){const{options:e}=this.customTooltip;if(e.isFixed)return;const{clientX:o,clientY:s}=t;this.customTooltip.options={...e,coordinates:[o,s]}},onMouseOut({seriesIndex:t,event:{event:e}},o){const{isEnabled:s}=this.props.neutralMetrics;!0===s&&this.chartInstance.setOption({series:this.adaptSeriesWithNeutral(o,t)});const{isFixed:i}=this.customTooltip.options;if(i)return;const{shouldRespondToPointerEvents:a}=this.props.customTooltip;if(!1===a)return void(this.customTooltip.isShown=!1);const{relatedTarget:r}=e;null==r&&(this.customTooltip.isShown=!1)},onMouseOver({seriesIndex:t,name:e,seriesName:o,value:s,event:{event:i}},a){const{isEnabled:r}=this.props.neutralMetrics;!0===r&&this.chartInstance.setOption({series:this.toggleNeutralSeriesColors({series:a,seriesIndex:t})});const{isEnabled:n,shouldFollowPointer:l}=this.props.customTooltip;if(!1===n)return;const{results:d,customTooltip:{options:c,isShown:u}}=this;if(c.isFixed&&u)return;const{dimensionOptions:h}=this.props,{metricName:m}=a.find(({name:t})=>t===o),{clientX:p,clientY:S}=i;this.customTooltip.options={...c,coordinates:[p,S],data:y.Wp.buildCustomTooltipData(d,h,{dimensionName:e,value:s},{seriesName:o,metricName:m})},this.customTooltip.isShown=!0}},implicitCssModule:!0},D=T;var O=o(97880),M=o(81656);function P(t){this["$style"]=O["default"].locals||O["default"]}var k=(0,M.A)(D,s,i,!1,P,null,null);const W=k.exports}};