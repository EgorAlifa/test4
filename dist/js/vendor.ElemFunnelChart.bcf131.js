export const __webpack_id__=674;export const __webpack_ids__=[674];export const __webpack_modules__={28701:(t,e,s)=>{var r=s(59664);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=s(99548).A;a("3e35f70d",r,!0,{sourceMap:!1,shadowMode:!1})},59664:(t,e,s)=>{s.r(e),s.d(e,{default:()=>o});var r=s(31601),a=s.n(r),n=s(76314),i=s.n(n),l=i()(a());l.push([t.id,".btn[data-v-389a8778],.btn-primary[data-v-389a8778],.btn-secondary[data-v-389a8778],.btn-sm[data-v-389a8778],.btn[data-v-389a8778]:disabled{@apply opacity-50 cursor-not-allowed}",""]);const o=l},89934:(t,e,s)=>{s.r(e),s.d(e,{default:()=>z});var r=function(){var t=this,e=t._self._c;return e("w-elem",{attrs:{placeholder:t.$placeholder}},[e("div",{ref:"chartContainer",staticClass:"w-100 h-100 min-h-[400px]",class:{"cursor-pointer":t.drilldownCanPush}},[t.hasError?e("div",{staticClass:"flex items-center justify-center h-full"},[e("div",{staticClass:"text-red-600 text-center"},[e("i",{staticClass:"mdi mdi-alert-circle-outline text-4xl mb-2"}),e("p",{staticClass:"text-lg font-medium"},[t._v(t._s(t.error))])])]):t.hasDataset&&t.result&&t.result.rows&&0!==t.result.rows.length?t.isLoading?e("div",{staticClass:"flex items-center justify-center h-full"},[e("div",{staticClass:"text-center"},[e("div",{staticClass:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e("p",{staticClass:"text-gray-600"},[t._v("Загрузка данных...")])])]):t._e():e("div",{staticClass:"flex items-center justify-center h-full"},[e("div",{staticClass:"text-gray-500 text-center"},[e("i",{staticClass:"mdi mdi-chart-funnel text-4xl mb-2"}),e("p",{staticClass:"text-lg"},[t._v(t._s(t.hasDataset?"Нет данных для отображения":"Датасет не выбран"))])])])]),t.showDrilldownControls?e("div",{staticClass:"flex gap-2 mt-2 p-2 bg-gray-50 rounded"},[e("button",{staticClass:"btn btn-sm",class:{"btn-primary":t.drilldownCanPush,"btn-secondary":!t.drilldownCanPush},attrs:{disabled:!t.drilldownCanPush},on:{click:t.handleDrilldownPush}},[e("i",{staticClass:"mdi mdi-drill mr-1"}),t._v(" Детализация: "+t._s(t.drilldownCanPush?"доступна":"недоступна")+" ")]),e("button",{staticClass:"btn btn-sm",class:{"btn-primary":t.drilldownCanPop,"btn-secondary":!t.drilldownCanPop},attrs:{disabled:!t.drilldownCanPop},on:{click:t.handleDrilldownPop}},[e("i",{staticClass:"mdi mdi-arrow-left mr-1"}),t._v(" Назад: "+t._s(t.drilldownCanPop?"доступно":"недоступно")+" ")])]):t._e()])},a=[],n=s(93423),i=s(5021),l=s(7609),o=s.n(l);const d={default:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],blue:["#1e3a8a","#1e40af","#2563eb","#3b82f6","#60a5fa","#93c5fd","#bfdbfe","#dbeafe"],green:["#14532d","#166534","#15803d","#16a34a","#22c55e","#4ade80","#86efac","#bbf7d0"],orange:["#9a3412","#c2410c","#ea580c","#f97316","#fb923c","#fdba74","#fed7aa","#ffedd5"],purple:["#581c87","#6b21a8","#7c3aed","#8b5cf6","#a78bfa","#c4b5fd","#ddd6fe","#ede9fe"],rainbow:["#ff0000","#ff8000","#ffff00","#80ff00","#00ff00","#00ff80","#00ffff","#0080ff","#0000ff","#8000ff"]},h=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),c=t=>`${t.name}: ${t.value} (${t.percent}%)`,p=(t,e,s,r="descending")=>{if(!t||!e||!s)return[];let a=t.map(t=>({name:t[e]||"Неизвестно",value:Number(t[s])||0}));return"descending"===r?a.sort((t,e)=>e.value-t.value):"ascending"===r&&a.sort((t,e)=>t.value-e.value),a},u=(t="default")=>d[t]||d.default,f=(t,e="default")=>{const s=u(e),r=[];for(let a=0;a<t.length;a++){const t=a%s.length;r.push(s[t])}return r},m=({data:t,orientation:e="vertical",labelPosition:s="outside",showPercentage:r=!0,funnelWidth:a="80%",funnelHeight:n="80%",gap:i=2,colorScheme:l="default",showTitle:o=!0,title:d="",showLegend:p=!0,legendPosition:u="right"})=>{const m=f(t,l),w={color:m,tooltip:{trigger:"item",formatter:r?c:"{b}: {c}"},series:[{name:"Воронка",type:"funnel",orient:e,left:"horizontal"===e?"10%":"center",top:"horizontal"===e?"center":"60",width:a,height:n,gap:i,sort:"none",label:{show:!0,position:s,formatter:r?t=>`${t.name}\n${h(t.value)} (${t.percent}%)`:t=>`${t.name}\n${h(t.value)}`},labelLine:{show:"outside"===s,length:10,lineStyle:{width:1,type:"solid"}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:t}]};return o&&d&&(w.title={text:d,left:"center",top:"20",textStyle:{fontSize:18,fontWeight:"bold"}}),p&&(w.legend={orient:"top"===u||"bottom"===u?"horizontal":"vertical",left:"left"===u?"10":"right"===u?"right":"center",top:"top"===u?"10":"bottom"===u?"bottom":"middle",data:t.map(t=>t.name)}),w},w=(t,e)=>{e&&t.name&&e(t.name,t.value)},g=t=>!(!Array.isArray(t)||0===t.length)&&t.every(t=>t&&"string"===typeof t.name&&"number"===typeof t.value&&t.value>=0);var b=s(35737);const C={data:t=>({}),computed:{},methods:{validateSettings(){const t=[];return this.props.metric||t.push("Не выбрана метрика для значений воронки"),this.props.dimension||t.push("Не выбрано измерение для названий этапов"),t},getRecommendedSettings(){const t={};return this.props.sort&&"none"!==this.props.sort||(t.sort="descending",t.reason="Рекомендуется сортировка по убыванию для воронок"),this.props.showPercentage||(t.showPercentage=!0,t.reason="Проценты помогают понять долю каждого этапа"),t}}},y=[b.A],v=()=>({props:{metric:{type:String,default:null,label:"Метрика (значения воронки)"},dimension:{type:String,default:null,label:"Измерение (названия этапов)"},drilldownName:{type:String,default:null,label:"Дриллдаун"},orientation:{type:String,default:"vertical",label:"Ориентация"},sort:{type:String,default:"descending",label:"Сортировка"},labelPosition:{type:String,default:"outside",label:"Позиция лейблов"},showPercentage:{type:Boolean,default:!0,label:"Показывать проценты"},funnelWidth:{type:String,default:"80%",label:"Ширина воронки"},funnelHeight:{type:String,default:"80%",label:"Высота воронки"},gap:{type:Number,default:2,label:"Расстояние между сегментами"},colorScheme:{type:String,default:"default",label:"Цветовая схема"},showTitle:{type:Boolean,default:!0,label:"Показывать заголовок"},title:{type:String,default:"",label:"Заголовок диаграммы"},showLegend:{type:Boolean,default:!0,label:"Показывать легенду"},legendPosition:{type:String,default:"right",label:"Позиция легенды"}}}),P={descriptor:v,panels:y,isChildAllowed:!1},S=(0,i.useDatasetMeta)(P,{panel:{mixins:[C]}}),x={},_=(0,i.useElemDatasetMixin)({drilldown:!0,panel:!1}),D={extends:n.Elem,mixins:[_],meta:S,created(){console.log("ElemFunnelChart created!")},hooks:{then(t){this.processData(t)},catch(t){this.error=t?.message||"Произошла ошибка при загрузке данных",console.error("ElemFunnelChart error:",t)},finally(){this.isLoading=!1}},data(){return{chartInstance:null,funnelData:[],error:null,showDrilldownControls:!1,selectedSegment:null,...i.ElemDatasetMixinTypes}},computed:{hasError(){return null!==this.error},drilldownState(){return this.props.drilldownName?{canPop:!1,canPush:!1,...this.$drilldown.state[this.props.drilldownName]}:{canPop:!1,canPush:!1}},drilldownCanPop(){return this.drilldownState.canPop},drilldownCanPush(){return this.drilldownState.canPush&&null!==this.selectedSegment},chartOptions(){return g(this.funnelData)?m({data:this.funnelData,orientation:this.props.orientation,labelPosition:this.props.labelPosition,showPercentage:this.props.showPercentage,funnelWidth:this.props.funnelWidth,funnelHeight:this.props.funnelHeight,gap:this.props.gap,colorScheme:this.props.colorScheme,showTitle:this.props.showTitle,title:this.props.title||this.result?.name||"Воронка",showLegend:this.props.showLegend,legendPosition:this.props.legendPosition}):null}},watch:{chartOptions:{handler(t){t&&this.chartInstance&&this.updateChart(t)},deep:!0},"props.orientation"(){this.updateChart()},"props.labelPosition"(){this.updateChart()},"props.showPercentage"(){this.updateChart()},"props.colorScheme"(){this.updateChart()},"props.showTitle"(){this.updateChart()},"props.title"(){this.updateChart()},"props.showLegend"(){this.updateChart()},"props.legendPosition"(){this.updateChart()}},mounted(){this.initChart(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){this.destroyChart(),window.removeEventListener("resize",this.handleResize)},methods:{...x,...i.ElemDatasetMixinTypes,initChart(){if(this.$refs.chartContainer)try{this.chartInstance=o().init(this.$refs.chartContainer),this.chartInstance.on("click",this.handleChartClick),this.chartOptions&&this.updateChart(this.chartOptions)}catch(t){console.error("Ошибка инициализации ECharts:",t),this.error="Ошибка инициализации диаграммы"}},destroyChart(){this.chartInstance&&(this.chartInstance.dispose(),this.chartInstance=null)},updateChart(t=null){if(!this.chartInstance)return;const e=t||this.chartOptions;if(e)try{this.chartInstance.setOption(e,!0)}catch(s){console.error("Ошибка обновления диаграммы:",s),this.error="Ошибка обновления диаграммы"}},processData(t){if(this.error=null,t&&t.rows&&Array.isArray(t.rows))if(this.props.metric&&this.props.dimension)try{if(this.funnelData=p(t.rows,this.props.dimension,this.props.metric,this.props.sort),!g(this.funnelData))return void(this.error="Нет валидных данных для отображения");this.chartInstance&&this.chartOptions&&this.updateChart(this.chartOptions)}catch(e){console.error("Ошибка обработки данных:",e),this.error="Ошибка обработки данных"}else this.error="Не выбраны метрика или измерение";else this.error="Некорректный формат данных"},handleChartClick(t){this.selectedSegment={name:t.name,value:t.value},this.props.drilldownName&&this.drilldownCanPush&&w(t,this.performDrilldown)},performDrilldown(t,e){const{drilldownName:s}=this.props;if(s)try{this.$storeCommit({[s]:t}),this.$drilldown.push(s,t)}catch(r){console.error("Ошибка drilldown:",r)}},handleDrilldownPush(){this.selectedSegment&&this.drilldownCanPush&&this.performDrilldown(this.selectedSegment.name,this.selectedSegment.value)},handleDrilldownPop(){const{drilldownName:t}=this.props;if(t&&this.drilldownCanPop)try{this.$drilldown.pop(t),this.$storeCommit({[t]:null}),this.selectedSegment=null}catch(e){console.error("Ошибка drilldown pop:",e)}},handleResize(){if(this.chartInstance)try{this.chartInstance.resize()}catch(t){console.error("Ошибка изменения размера диаграммы:",t)}}}},$=D;s(28701);var I=s(81656),E=(0,I.A)($,r,a,!1,null,"389a8778",null);const z=E.exports}};